<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnQuick_Official</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src='//libtl.com/sdk.js' data-zone='10070523' data-sdk='show_10070523'></script>
    
    <style>
        :root {
            --primary-blue: #234d7d; --green-earn: #4CAF50; --orange-withdraw: #FF9800;
            --secondary-bg: #f5f5f5; --text-color: #333;
        }
        body { font-family: 'Arial', sans-serif; background-color: var(--secondary-bg); color: var(--text-color); margin: 0; padding: 0; touch-action: manipulation; }
        .container { padding: 0; max-width: 600px; margin: auto; background-color: white; min-height: 100vh; }
        .balance-card { background-color: var(--primary-blue); color: white; padding: 20px; text-align: center; border-radius: 0 0 15px 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 20px; }
        .balance-card h3 { margin: 0; font-size: 16px; opacity: 0.8; }
        .balance-card span { display: block; font-size: 48px; font-weight: bold; margin: 5px 0 10px 0; }
        .balance-card p.note { margin: 0; font-size: 14px; opacity: 0.9; }

        #ad-button, #withdraw-button { border: none; padding: 15px 20px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 90%; margin: 10px 5%; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        #ad-button { background-color: var(--green-earn); color: white; }
        #withdraw-button { background-color: var(--orange-withdraw); color: white; }
        #ad-button:disabled { background-color: #ccc; cursor: not-allowed; }

        .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 20px 10px; border-top: 1px solid #eee; margin-top: 20px; }
        .menu-btn-container { text-align: center; }
        .menu-btn { background: none; border: none; color: var(--primary-blue); font-size: 14px; cursor: pointer; display: block; width: 100%; padding: 5px 0; }
        .menu-icon { font-size: 24px; margin-bottom: 5px; display: block; }
        .ad-container { text-align: center; background-color: #fff; overflow: hidden; margin-bottom: 10px; min-height: 90px; } 
        #status-message { text-align: center; padding: 10px; color: var(--primary-blue); font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="balance-card">
            <h3>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (EarnQuick Points)</h3>
            <span id="user-points">0</span>
            <p class="note">‡ß≥‡ß®‡ß¶‡ß¶‡ß¶ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = ‡ß™‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p> 
        </div>
        
        <div class="ad-container">
            <script type="text/javascript">
                var atOptions = {
                    'key' : '00605022df81b880d400151bfc7c2185',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
                document.write('<scr' + 'ipt type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></scr' + 'ipt>');
            </script>
        </div>

        <button id="ad-button" disabled>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ßß ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button id="withdraw-button" onclick="openWithdrawal()">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)</button>
        <p id="status-message">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>

        <div class="menu-grid">
            <div class="menu-btn-container" onclick="openReferral()"><span class="menu-icon">üîó</span><button class="menu-btn">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
            <div class="menu-btn-container" onclick="openHistory()"><span class="menu-icon">üßæ</span><button class="menu-btn">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</button></div>
            <div class="menu-btn-container"><span class="menu-icon">üìû</span><button class="menu-btn" onclick="openSupport()">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button></div>
        </div>
        
        <div class="ad-container" style="margin-top: 20px;">
            <script type="text/javascript">
                var atOptions = {
                    'key' : '00605022df81b880d400151bfc7c2185',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
                document.write('<scr' + 'ipt type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></scr' + 'ipt>');
            </script>
        </div>
    </div>
    
    <script>
        // --- ‡¶ï‡¶®‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶∏ ---
        const SERVER_URL = 'https://smartearnbdbot.onrender.com'; 
        const BOT_USERNAME = "@EarnQuick_Official_bot";
        
        // ‚òÖ‚òÖ‚òÖ ‡¶≤‡¶∏ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‚òÖ‚òÖ‚òÖ
        const POINTS_PER_AD = 1; 
        const MIN_WITHDRAW = 2000; 
        // ---------------------------------
        
        const REFERRAL_POINTS = 250; 

        let telegramUserId = null;
        let currentPoints = 0;

        // --- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶ì API ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function loadTelegramUser() {
            try {
                const user = Telegram.WebApp.initDataUnsafe.user;
                if (user && user.id) {
                    telegramUserId = user.id.toString();
                    return true;
                }
                document.getElementById('status-message').innerText = "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§";
                return false;
            } catch (e) {
                document.getElementById('status-message').innerText = "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ SDK ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§";
                return false;
            }
        }
        function updateUI() { document.getElementById('user-points').innerText = currentPoints.toLocaleString(); }
        
        async function fetchUserData() {
             document.getElementById('status-message').innerText = "‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
             try {
                 const response = await fetch(`${SERVER_URL}/api/user/${telegramUserId}`);
                 
                 if (response.ok) {
                     const data = await response.json();
                     currentPoints = data.earned_points;
                     updateUI();
                     document.getElementById('status-message').innerText = "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶ö‡¶≤ ‡¶Ü‡¶õ‡ßá‡¶®‡•§";
                     document.getElementById('ad-button').disabled = false;
                 } else {
                     document.getElementById('status-message').innerText = `‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§`;
                     Telegram.WebApp.showAlert(`‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§`);
                 }
             } catch (error) {
                 console.error('Fetch Error:', error);
                 document.getElementById('status-message').innerText = "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§ (‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ)";
                 Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ URL ‡¶¨‡¶æ CORS ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
             }
        }

        async function addPointsToUser(pointsToAdd) {
             if (!telegramUserId) return;
             document.getElementById('status-message').innerText = "‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
             document.getElementById('ad-button').disabled = true;
             
             try {
                const response = await fetch(`${SERVER_URL}/api/add_points`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: telegramUserId, points: pointsToAdd })
                });
                const data = await response.json();

                if (data.success) {
                    currentPoints = data.new_points;
                    updateUI();
                    document.getElementById('status-message').innerText = `${pointsToAdd} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Æ‡ßã‡¶ü: ${currentPoints.toLocaleString()}`;
                } else {
                    document.getElementById('status-message').innerText = `‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø: ${data.message || 'Unknown error'}`;
                    Telegram.WebApp.showAlert("‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
                }
             } catch (error) {
                document.getElementById('status-message').innerText = "‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§";
                Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
             } finally {
                setTimeout(() => { document.getElementById('ad-button').disabled = false; }, 5000); 
             }
        }

        // --- ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ì ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶≤‡¶ú‡¶ø‡¶ï ---
        function onAdRewardSuccess() { 
             addPointsToUser(POINTS_PER_AD); 
        }

        function handleAdButtonClick() {
            if (!telegramUserId) return;

            document.getElementById('status-message').innerText = "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...";
            document.getElementById('ad-button').disabled = true;

            // Monetag Rewarded Ad ‡¶≤‡¶ú‡¶ø‡¶ï
            const adFunction = window.show_10070523; 
            const ymid = telegramUserId; 

            if (typeof adFunction === 'function') {
                adFunction({ ymid: ymid })
                .then(() => {
                    console.log('Monetag Ad viewed successfully');
                    onAdRewardSuccess(); 
                })
                .catch((error) => {
                    console.error('Monetag Ad failed:', error);
                    document.getElementById('status-message').innerText = "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶°/‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                    setTimeout(() => { document.getElementById('ad-button').disabled = false; }, 3000); 
                });
            } else {
                document.getElementById('status-message').innerText = "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø! ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                setTimeout(() => { document.getElementById('ad-button').disabled = false; }, 5000); 
            }
        }
        
        // --- ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ openWithdrawal() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        async function openWithdrawal() {
            if (!telegramUserId) return;

            // 1. ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶ö‡ßá‡¶ï (‡ß®‡ß¶‡ß¶‡ß¶ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü = ‡ß™‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ)
            if (currentPoints < MIN_WITHDRAW) {
                Telegram.WebApp.showAlert(`‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${MIN_WITHDRAW} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (‡ß≥${(MIN_WITHDRAW/50).toFixed(0)}) ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü: ${currentPoints.toLocaleString()}`);
                return;
            }

            const withdrawAmount = MIN_WITHDRAW; 
            const equivalentTaka = (withdrawAmount / 50).toFixed(0); 
            
            // 2. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶™‡¶Ü‡¶™
            Telegram.WebApp.showPopup({
                title: "‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®",
                message: `‡¶Ü‡¶™‡¶®‡¶ø ${withdrawAmount.toLocaleString()} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (‡ß≥${equivalentTaka} ‡¶ü‡¶æ‡¶ï‡¶æ) ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶õ‡ßá‡¶®‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:`,
                buttons: [
                    { id: 'bKash', text: '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂' },
                    { id: 'Nagad', text: '‡¶®‡¶ó‡¶¶' },
                    { id: 'cancel', text: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤' }
                ]
            }, async function(paymentMethod) {
                if (paymentMethod === 'cancel' || !paymentMethod) return;

                // 3. ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
                const paymentNumber = prompt(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ${paymentMethod} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: 01xxxxxxxxx):`);

                // ‡¶¨‡ßá‡¶∏‡¶ø‡¶ï ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
                if (!paymentNumber || paymentNumber.length < 10) {
                    Telegram.WebApp.showAlert("‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    return;
                }
                
                // 4. ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
                document.getElementById('status-message').innerText = `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
                document.getElementById('withdraw-button').disabled = true; 
                
                try {
                    const response = await fetch(`${SERVER_URL}/api/withdraw`, { 
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: telegramUserId,
                            pointsToWithdraw: withdrawAmount,
                            paymentMethod: paymentMethod,
                            paymentNumber: paymentNumber
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        currentPoints = data.new_points; 
                        updateUI();
                        document.getElementById('status-message').innerText = `‚úÖ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Æ‡ßã‡¶ü: ${currentPoints.toLocaleString()} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü‡•§`;
                        Telegram.WebApp.showAlert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∏‡¶´‡¶≤! ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§");
                    } else {
                        document.getElementById('status-message').innerText = `‚ùå ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${data.message || 'Unknown error'}`;
                        Telegram.WebApp.showAlert(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${data.message || 'Unknown error'}`);
                    }
                } catch (error) {
                    console.error('Withdrawal Fetch Error:', error);
                    document.getElementById('status-message').innerText = "‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§";
                    Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
                } finally {
                    document.getElementById('withdraw-button').disabled = false; 
                }
            });
        }
        // --- ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ openWithdrawal() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ ---

        function openReferral() {
            if (!telegramUserId) return;
            const referralLink = `https://t.me/${BOT_USERNAME}?start=${telegramUserId}`;
            const message = `üéâ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï:\n\nüîó ${referralLink}\n\nüî• ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶®: ${REFERRAL_POINTS} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡•§`;
            
            Telegram.WebApp.showPopup({
                title: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï",
                message: message,
                buttons: [{id: 'copy', text: '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®'}, {id: 'close', text: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®'}]
            }, function(buttonId) {
                if (buttonId === 'copy') {
                    navigator.clipboard.writeText(referralLink).then(() => { Telegram.WebApp.showAlert('‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!'); });
                }
            });
        }
        
        function openSupport() { Telegram.WebApp.showAlert(`üìû ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:\n\n‡¶´‡ßã‡¶®: 01913621510\n‡¶á‡¶Æ‡ßá‡¶á‡¶≤: najmulh219653@gmail.com`); }
        function openHistory() { Telegram.WebApp.showAlert("‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§"); }


        // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ---
        document.addEventListener('DOMContentLoaded', () => {
            if (loadTelegramUser()) {
                fetchUserData();
                const adButton = document.getElementById('ad-button');
                if (adButton) {
                    adButton.addEventListener('click', handleAdButtonClick);
                }
            }
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        });
    </script>
</body>
</html>

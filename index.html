<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnQuick üéØ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src='//libtl.com/sdk.js' data-zone='10070523' data-sdk='show_ad_zone_1'></script>
    <script src='//libtl.com/sdk.js' data-zone='9852420' data-sdk='show_ad_zone_2'></script>
    <script src='//libtl.com/sdk.js' data-zone='10085320' data-sdk='show_ad_zone_3'></script> 

    <style>
        /* ------------------ COMMON STYLES ------------------ */
        :root { 
            --primary-blue: #234d7d; 
            --green-earn: #4CAF50; 
            --orange-withdraw: #FF9800; 
            --secondary-bg: #f5f7f9; 
            --text-color: #333; 
        }
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: var(--secondary-bg); 
            color: var(--text-color); 
            margin: 0; padding: 0; 
            touch-action: manipulation; 
            overflow-x: hidden; 
            width: 100vw; 
        }
        .container { 
            padding: 0; 
            max-width: 600px; 
            margin: auto; 
            background-color: white; 
            min-height: 100vh; 
        }
        .header-container { 
            background: linear-gradient(135deg, #1d2b64, #f8cdda); 
            color: white; 
            padding: 20px 0; 
            text-align: center; 
            border-radius: 0 0 15px 15px; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); 
            margin-bottom: 20px; 
        }
        .marquee-container { 
            background-color: #e3f2fd; 
            color: #1976d2; 
            padding: 5px 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-size: 0.9em; 
            font-weight: bold; 
            overflow: hidden; 
            border: 1px solid #bbdefb; 
        }
        
        /* Main Action Buttons Styling */
        #ad-button, #withdraw-button { 
            border: none; 
            padding: 15px 20px; 
            font-size: 16px; 
            font-weight: bold; 
            border-radius: 8px; 
            cursor: pointer; 
            width: 90%; 
            margin: 10px 5%; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }
        #ad-button { 
            background-color: var(--green-earn); 
            color: white; 
        }
        #withdraw-button { 
            background-color: var(--orange-withdraw); 
            color: white; 
        }
        #withdraw-button.disabled-time { 
            background-color: #FF5722; 
            cursor: not-allowed; 
        } 
        
        /* Menu Grid Buttons */
        .menu-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            padding: 10px 5%;
        }
        .menu-btn-container {
            width: 45%;
            margin-bottom: 10px;
            text-align: center;
        }
        .menu-btn {
            background-color: #e0e0e0;
            color: var(--text-color);
            border: none;
            padding: 10px 5px;
            font-size: 14px;
            border-radius: 8px;
            width: 100%;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .menu-icon {
            margin-right: 5px;
            font-size: 1.2em;
        }


        /* Ad View Popup Styles (Optimized) */
        #ad-view-popup { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; 
            background: #f0f4f7; 
            background-size: cover; backdrop-filter: blur(5px); 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
            padding: 0; box-sizing: border-box; overflow-y: auto; touch-action: manipulation; 
        }
        #cancel-ad-view { 
            position: sticky; top: 0; 
            z-index: 1001; background-color: #f44336; color: white; border: none; 
            padding: 10px 20px; font-size: 14px; font-weight: bold; border-radius: 8px; cursor: pointer; 
            width: 95%; max-width: 400px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); margin-top: 10px;
        }
        .ad-view-content { 
            background-color: rgba(255, 255, 255, 1); 
            padding: 20px; border-radius: 15px; width: 95%; max-width: 400px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4); text-align: center; margin-top: 10px; margin-bottom: 20px; 
        }
        .ad-view-content button.ad-button-new {
            background-color: #2196F3; 
            color: white;
            border: none;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* --- Admin Panel Styles --- */
        .admin-view { padding: 10px; background-color: #f0f4f7; min-height: 100vh; }
        .admin-stats-summary { display: flex; flex-wrap: wrap; justify-content: space-between; margin-bottom: 20px; }
        .stat-card { background-color: #ffffff; padding: 15px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); width: 48%; margin-bottom: 10px; text-align: center; }
        .stat-card.full-width { width: 100%; }
        .stat-card h4 { margin: 0 0 5px 0; color: #607D8B; font-size: 0.9em; }
        .stat-card p { margin: 0; font-size: 1.5em; font-weight: bold; color: #1d2b64; }
        .stat-card.pending p { color: #FF5722; }

        .withdrawal-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .withdrawal-card p { margin: 5px 0; font-size: 14px; }
        .action-buttons button { margin-top: 10px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .complete-btn { background-color: #4CAF50; color: white; margin-right: 10px; }
        .cancel-btn { background-color: #F44336; color: white; }
    </style>
</head>
<body>
    
    <div class="user-view">
        <div class="header-container">
            <div class="headline-text">üí∞ EarnQuick Official - ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! üí∞</div>
            <div class="referral-info">
                ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span id="referral-count-display">0</span> ‡¶ú‡¶® | 
                ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: 250 ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü
            </div>
            
            <div class="balance-card">
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                <span class="points-display" id="total-points">0</span>
                <p>‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: 10000 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = 40 ‡¶ü‡¶æ‡¶ï‡¶æ</p>
            </div>
        </div>
        
        <div class="ad-container">
            </div>
        
        <div class="marquee-container">
            <marquee behavior="scroll" direction="left" scrollamount="6">
                ‚ú® **‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ò‡ßã‡¶∑‡¶£‡¶æ:** ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: **‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨:‡ß¶‡ß¶‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßÆ:‡ß¶‡ß¶‡¶ü‡¶æ** ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§‡•§ | ü§ù ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ **250 ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü** ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ú‡¶ø‡¶§‡ßá ‡¶®‡¶ø‡¶®! | üìû **‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó**: 01913621510 | üèÜ ‡¶Ü‡¶∞‡ßã ‡¶∏‡¶π‡¶ú ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®‡•§
            </marquee>
        </div>
        
        <button id="ad-button" disabled onclick="showAdView()">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç 5 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button id="withdraw-button" onclick="openWithdrawal()">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)</button>
        <p id="status-message">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>

        <div class="menu-grid">
            <div class="menu-btn-container" onclick="openReferral()"><span class="menu-icon">üîó</span><button class="menu-btn">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
            <div class="menu-btn-container" onclick="openHistory()"><span class="menu-icon">üßæ</span><button class="menu-btn">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</button></div>
            <div class="menu-btn-container"><span class="menu-icon">üìû</span><button class="menu-btn" onclick="openSupport()">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button></div>
            
            <div class="menu-btn-container" id="admin-access-btn-container" style="display:none;" onclick="toggleAdminView(true)">
                <span class="menu-icon" style="color:#f44336;">üëë</span>
                <button class="menu-btn" style="background-color: #f44336; color: white;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</button>
            </div>
            </div>
        
        <div class="ad-container" style="margin-top: 20px;">
            </div>
    </div>
    
    <div id="ad-view-popup" style="display: none;">
        <button id="cancel-ad-view" onclick="hideAdView()">‚óÄÔ∏è ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶® (Cancel)</button>
        
        <div class="ad-view-content">
            <h2>üéØ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï: ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h2>
            <div id="ad-view-status" class="ad-stat-card"></div>
            
            <div class="ad-banner-slot">
                </div>

            <p style="font-size: 0.9em; margin: 15px 0;">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá **5** ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü!</p>
            
            <button class="ad-button-new" id="ad-btn-1" onclick="handleIndividualAdClick(1)">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ßß (‡ß´ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü)</button>
            <button class="ad-button-new" id="ad-btn-2" onclick="handleIndividualAdClick(2)">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß® (‡ß´ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü)</button>
            <button class="ad-button-new" id="ad-btn-3" onclick="handleIndividualAdClick(3)">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß© (‡ß´ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü)</button>
            
            <div class="ad-banner-slot" style="margin-top: 15px;">
                </div>
        </div>
    </div>

    <div class="admin-view" id="admin-main-view" style="display:none;">
        <h2 style="text-align: center; color: #1d2b64; padding-top: 10px;">üèÜ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
        <p style="text-align: center; font-weight: bold; color: #f44336; margin-bottom: 20px;">‚ö†Ô∏è ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶Ü‡¶õ‡ßá‡¶®‡•§</p>
        
        <div class="admin-stats-summary">
            <div class="stat-card">
                <h4>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h4>
                <p id="stat-total-users">...</p>
            </div>
            <div class="stat-card">
                <h4>‡¶Æ‡ßã‡¶ü ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü (‡¶∏‡¶ï‡¶≤)</h4>
                <p id="stat-total-points">...</p>
            </div>
            <div class="stat-card full-width pending">
                <h4>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</h4>
                <p id="stat-pending-withdrawals">...</p>
            </div>
        </div>
        
        <button id="refresh-withdrawals" onclick="loadWithdrawals('Pending')" style="background-color: #2196F3; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 15px; font-weight: bold;">üîÑ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        
        <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
            <button onclick="loadWithdrawals('Pending')" style="padding: 8px; background-color: #FFC107; border: none; border-radius: 5px; font-weight: bold;">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</button>
            <button onclick="loadWithdrawals('Completed')" style="padding: 8px; background-color: #4CAF50; border: none; border-radius: 5px; font-weight: bold;">‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü‡ßá‡¶°</button>
            <button onclick="loadWithdrawals('Cancelled')" style="padding: 8px; background-color: #F44336; border: none; border-radius: 5px; font-weight: bold;">‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶∏‡ßá‡¶≤‡¶°</button>
        </div>
        
        <h3 id="withdrawal-list-title" style="color: #607D8B;">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
        <div id="withdrawal-list-container">
            <p style="text-align: center;" id="admin-status-message">‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
        </div>
        
        <button onclick="toggleAdminView(false)" style="background-color: #795548; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 20px; font-weight: bold;">üë§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶â‡¶§‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
    </div>
    
    <script>
        // --- ‡¶ï‡¶®‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶∏ ---
        const SERVER_URL = 'https://smartearnbdbot.onrender.com'; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Render URL
        const BOT_USERNAME = "@EarnQuick_Official_bot";
        const POINTS_PER_TAKA = 250; 
        const POINTS_PER_AD = 5; 
        const MIN_WITHDRAW_POINTS = 10000;
        const WITHDRAW_START_HOUR = 6;  
        const WITHDRAW_END_HOUR = 20; 

        // ‚òÖ‚òÖ‚òÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‚òÖ‚òÖ‚òÖ
        const CONTACT_NUMBER = '01913621510'; 
        const CONTACT_EMAIL = 'najmulh219653@gmail.com';
        const ADMIN_ID = '8145444675'; // ‚òÖ‚òÖ‚òÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‚òÖ‚òÖ‚òÖ

        let telegramUserId = null;
        let currentPoints = 0;
        
        // --- ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶ì API ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function loadTelegramUser() {
            try {
                const user = Telegram.WebApp.initDataUnsafe.user;
                if (user && user.id) {
                    telegramUserId = user.id.toString();
                    return true;
                }
                document.getElementById('status-message').innerText = "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§";
                return false;
            } catch (e) {
                document.getElementById('status-message').innerText = "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ SDK ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§";
                return false;
            }
        }
        
        // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡ßã‡¶° ‡¶ü‡¶ó‡¶≤ ‡¶ï‡¶∞‡¶æ ---
        function toggleAdminView(isAdmin) {
            if (isAdmin) {
                document.querySelector('.user-view').style.display = 'none';
                document.getElementById('ad-view-popup').style.display = 'none'; 
                document.getElementById('admin-main-view').style.display = 'block';
                loadAdminStats(); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ
                document.getElementById('withdrawal-list-container').innerHTML = '';
                document.getElementById('admin-status-message').innerText = "‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®...";
            } else {
                document.querySelector('.user-view').style.display = 'block';
                document.getElementById('admin-main-view').style.display = 'none';
                if (telegramUserId) fetchUserData(true); 
            }
        }
        
        // ‚òÖ‚òÖ‚òÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‚òÖ‚òÖ‚òÖ
        async function loadAdminStats() {
            document.getElementById('stat-total-users').innerText = '...';
            document.getElementById('stat-total-points').innerText = '...';
            document.getElementById('stat-pending-withdrawals').innerText = '...';
            
            try {
                const response = await fetch(`${SERVER_URL}/api/get_admin_stats`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    document.getElementById('stat-total-users').innerText = data.total_users.toLocaleString();
                    document.getElementById('stat-total-points').innerText = data.total_points.toLocaleString();
                    document.getElementById('stat-pending-withdrawals').innerText = data.pending_withdrawals.toLocaleString();
                } else {
                    // DB Error handler
                    document.getElementById('stat-total-users').innerText = '0 (DB Error)';
                    document.getElementById('stat-total-points').innerText = '0 (DB Error)';
                    document.getElementById('stat-pending-withdrawals').innerText = '0 (DB Error)';
                    document.getElementById('admin-status-message').innerText = '‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶∏‡ßç‡¶ü‡ßá‡¶™ ‡ßß ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                    Telegram.WebApp.showAlert('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                }
            } catch (error) {
                console.error('Admin Stats Error:', error);
                document.getElementById('stat-total-users').innerText = '0 (Net Error)';
                document.getElementById('stat-total-points').innerText = '0 (Net Error)';
                document.getElementById('stat-pending-withdrawals').innerText = '0 (Net Error)';
                document.getElementById('admin-status-message').innerText = '‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á‡•§';
                Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§");
            }
        }

        // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ---
        async function loadWithdrawals(status) {
            document.getElementById('admin-status-message').innerText = `${status} ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
            document.getElementById('withdrawal-list-container').innerHTML = '';
            document.getElementById('withdrawal-list-title').innerText = `${status} ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ`;

            try {
                const response = await fetch(`${SERVER_URL}/api/get_withdrawals?status=${status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.length === 0) {
                        document.getElementById('admin-status-message').innerText = `‡¶è‡¶á ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá ‡¶ï‡ßã‡¶®‡ßã ${status} ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§`;
                        return;
                    }

                    document.getElementById('admin-status-message').innerText = `‡¶Æ‡ßã‡¶ü ${data.length}‡¶ü‡¶ø ${status} ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá‡•§`;
                    
                    data.forEach(request => {
                        const card = document.createElement('div');
                        card.className = 'withdrawal-card';
                        card.innerHTML = `
                            <p><strong>Req ID:</strong> ${request.id} | <strong>‡¶á‡¶â‡¶ú‡¶æ‡¶∞:</strong> ${request.telegram_user_id}</p>
                            <p><strong>‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü:</strong> ${request.points} (‡ß≥ ${(request.points / POINTS_PER_TAKA).toFixed(2)})</p>
                            <p><strong>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</strong> ${request.payment_method} - ${request.payment_number}</p>
                            <p><strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> <span style="color: ${status === 'Pending' ? 'orange' : status === 'Completed' ? 'green' : 'red'};">${request.status}</span> | <small>(${new Date(request.created_at).toLocaleString()})</small></p>
                            
                            ${request.status === 'Pending' ? `
                            <div class="action-buttons">
                                <button class="complete-btn" onclick="updateWithdrawalStatus(${request.id}, 'Completed', '${request.telegram_user_id}')">‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</button>
                                <button class="cancel-btn" onclick="updateWithdrawalStatus(${request.id}, 'Cancelled', '${request.telegram_user_id}')">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                            </div>
                            ` : ''}
                        `;
                        document.getElementById('withdrawal-list-container').appendChild(card);
                    });
                    
                    // ‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶™‡¶∞‡ßá ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ
                    loadAdminStats();

                } else {
                    document.getElementById('admin-status-message').innerText = `‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶≤‡¶ó ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§`;
                }
            } catch (error) {
                console.error('Admin Fetch Error:', error);
                document.getElementById('admin-status-message').innerText = "‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á‡•§";
            }
        }

        // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ---
        async function updateWithdrawalStatus(requestId, newStatus, userId) {
            if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ${requestId} ‡¶ï‡ßá "${newStatus}" ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${userId}`)) {
                return;
            }

            try {
                const response = await fetch(`${SERVER_URL}/api/update_withdrawal_status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        requestId: requestId,
                        status: newStatus
                    })
                });

                if (response.ok) {
                    Telegram.WebApp.showAlert(`‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ${requestId} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${newStatus} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
                    loadWithdrawals('Pending'); 
                    loadAdminStats(); // ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ
                } else {
                    const errorData = await response.json();
                    Telegram.WebApp.showAlert(`‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${errorData.message || response.status}`);
                }
            } catch (error) {
                Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§");
            }
        }
        
        // --- ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        async function fetchUserData(isRefresh = false) {
             if(!isRefresh) document.getElementById('status-message').innerText = "‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
             
             const urlParams = new URLSearchParams(window.location.search);
             const refererId = urlParams.get('start'); 
             
             try {
                 const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify({ 
                         userId: telegramUserId,
                         refererId: refererId 
                     })
                 });
                 
                 if (response.ok) {
                     const data = await response.json();
                     currentPoints = data.earned_points;
                     document.getElementById('total-points').innerText = currentPoints.toLocaleString();
                     document.getElementById('referral-count-display').innerText = data.referral_count.toLocaleString();
                     
                     if (data.message && data.message.includes('Referral bonus')) {
                        Telegram.WebApp.showAlert(`‚úÖ ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤! ${data.message.split('points added')[0].split('Referral bonus of ')[1]} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞‡¶ï‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
                     }

                     updateUI();
                     document.getElementById('status-message').innerText = "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶ö‡¶≤ ‡¶Ü‡¶õ‡ßá‡¶®‡•§";
                     document.getElementById('ad-button').disabled = false;
                     
                     // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≠‡¶ø‡¶ú‡¶ø‡¶¨‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø ‡¶ü‡¶ó‡¶≤ ‡¶ï‡¶∞‡¶æ
                     const adminBtnContainer = document.getElementById('admin-access-btn-container');
                     if (telegramUserId.toString() === ADMIN_ID) {
                         adminBtnContainer.style.display = 'flex'; 
                         document.getElementById('status-message').innerText += " (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§)";
                     } else {
                         adminBtnContainer.style.display = 'none'; 
                     }
                     
                 } else {
                     document.getElementById('status-message').innerText = `‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§`;
                     Telegram.WebApp.showAlert(`‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§`);
                 }
             } catch (error) {
                 console.error('Fetch Error:', error);
                 document.getElementById('status-message').innerText = "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡ß´-‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"; 
                 Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡ß´-‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§");
             }
        }

        // --- ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function updateUI() {
            const now = new Date();
            const hour = now.getHours();
            const isDisabled = hour < WITHDRAW_START_HOUR || hour >= WITHDRAW_END_HOUR;

            const withdrawButton = document.getElementById('withdraw-button');
            if (isDisabled) {
                withdrawButton.disabled = true;
                withdrawButton.classList.add('disabled-time');
                withdrawButton.innerText = `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡¶®‡ßç‡¶ß (‡¶∏‡¶ï‡¶æ‡¶≤ ${WITHDRAW_START_HOUR}‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ${WITHDRAW_END_HOUR}‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ)`;
            } else {
                 withdrawButton.disabled = false;
                 withdrawButton.classList.remove('disabled-time');
                 withdrawButton.innerText = `‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)`;
            }
        }
        
        // (addPointsToUser, showAdView, hideAdView, onAdRewardSuccess, handleIndividualAdClick, openWithdrawal, openReferral, openHistory, openSupport functions here)
        
        async function addPointsToUser(points) {
            try {
                const response = await fetch(`${SERVER_URL}/api/add_points`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: telegramUserId, points: points })
                });

                if (response.ok) {
                    const data = await response.json();
                    currentPoints = data.new_points;
                    document.getElementById('total-points').innerText = currentPoints.toLocaleString();
                    Telegram.WebApp.showAlert(`üéâ ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ${points} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);
                    return true;
                } else {
                    Telegram.WebApp.showAlert(`‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}`);
                    return false;
                }
            } catch (error) {
                Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§");
                return false;
            }
        }

        function showAdView() {
            document.getElementById('ad-view-popup').style.display = 'flex';
            document.querySelector('.user-view').style.display = 'none';
        }

        function hideAdView() {
            document.getElementById('ad-view-popup').style.display = 'none';
            document.querySelector('.user-view').style.display = 'block';
        }

        function onAdRewardSuccess(adIndex) {
            const adBtn = document.getElementById(`ad-btn-${adIndex}`);
            adBtn.disabled = true;
            adBtn.innerText = '‚úÖ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            
            addPointsToUser(POINTS_PER_AD).then(success => {
                if (success) {
                    adBtn.innerText = `‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá! (${POINTS_PER_AD} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü)`;
                } else {
                     adBtn.innerText = `‚ùå ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®`;
                     adBtn.disabled = false;
                }
            });
        }

        function handleIndividualAdClick(adIndex) {
            
            const adBtn = document.getElementById(`ad-btn-${adIndex}`);
            adBtn.disabled = true;
            adBtn.innerText = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... (‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®)';

            // Simulate Adsterra ad loading and reward
            setTimeout(() => {
                onAdRewardSuccess(adIndex);
            }, 5000); // 5 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá
            
            // You should typically call the Adsterra SDK function here (e.g., show_ad_zone_1)
        }
        
        function openWithdrawal() {
             // ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ
             const now = new Date();
             const hour = now.getHours();
             if (hour < WITHDRAW_START_HOUR || hour >= WITHDRAW_END_HOUR) {
                 Telegram.WebApp.showAlert(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶è‡¶ñ‡¶® ‡¶®‡¶Ø‡¶º‡•§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡ßü: ‡¶∏‡¶ï‡¶æ‡¶≤ ${WITHDRAW_START_HOUR}‡¶ü‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡ßü: ‡¶∞‡¶æ‡¶§ ${WITHDRAW_END_HOUR}‡¶ü‡¶æ‡•§`);
                 return;
             }

             if (currentPoints < MIN_WITHDRAW_POINTS) {
                 const needed = MIN_WITHDRAW_POINTS - currentPoints;
                 Telegram.WebApp.showAlert(`‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ${MIN_WITHDRAW_POINTS} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü (${MIN_WITHDRAW_POINTS / POINTS_PER_TAKA} ‡¶ü‡¶æ‡¶ï‡¶æ) ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∞‡ßã ${needed} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞‡•§`);
                 return;
             }

             Telegram.WebApp.showPopup({
                 title: `üí∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®`,
                 message: `‡¶Ü‡¶™‡¶®‡¶ø ${currentPoints} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü (${(currentPoints / POINTS_PER_TAKA).toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ) ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§\n\n‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° (Bkash/Nagad), ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:`,
                 buttons: [
                     { id: 'proceed', type: 'default', text: '‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®' },
                     { id: 'cancel', type: 'cancel', text: '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®' }
                 ]
             }, (buttonId) => {
                 if (buttonId === 'proceed') {
                     // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶¨‡¶≤‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
                     Telegram.WebApp.showPopup({
                         title: '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø',
                         message: '‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° (Bkash/Nagad), ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶§ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶® ‡¶§‡¶æ ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: Bkash, 01XXXXXXXXX, 10000)',
                         buttons: [{ id: 'submit', type: 'default', text: '‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®' }]
                     }, async (inputButtonId) => {
                         if (inputButtonId === 'submit') {
                             const userInput = prompt("‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶°, ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: Bkash, 01XXXXXXXXX, 10000):");
                             if (!userInput) return;

                             const parts = userInput.split(',').map(p => p.trim());
                             if (parts.length !== 3) {
                                 Telegram.WebApp.showAlert("‡¶´‡¶∞‡ßç‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶≠‡ßÅ‡¶≤‡•§ ‡¶§‡¶ø‡¶®‡¶ü‡¶ø ‡¶Ö‡¶Ç‡¶∂ ‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶®‡•§");
                                 return;
                             }

                             const [paymentMethod, paymentNumber, pointsStr] = parts;
                             const points = parseInt(pointsStr);

                             if (isNaN(points) || points < MIN_WITHDRAW_POINTS || points > currentPoints) {
                                 Telegram.WebApp.showAlert("‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶≠‡ßÅ‡¶≤ ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßá‡¶∂‡¶ø!");
                                 return;
                             }

                             try {
                                 const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                                     method: 'POST',
                                     headers: { 'Content-Type': 'application/json' },
                                     body: JSON.stringify({
                                         userId: telegramUserId,
                                         pointsToWithdraw: points,
                                         paymentMethod: paymentMethod,
                                         paymentNumber: paymentNumber
                                     })
                                 });

                                 if (response.ok) {
                                     const data = await response.json();
                                     currentPoints = data.new_points;
                                     document.getElementById('total-points').innerText = currentPoints.toLocaleString();
                                     Telegram.WebApp.showAlert('‚úÖ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§');
                                 } else {
                                     const errorData = await response.json();
                                     Telegram.WebApp.showAlert(`‚ùå ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${errorData.message || '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§'}`);
                                 }
                             } catch (error) {
                                 Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§");
                             }
                         }
                     });
                 }
             });
        }


        function openReferral() {
            const referralLink = `https://t.me/${BOT_USERNAME.replace('@', '')}?start=${telegramUserId}`;
            Telegram.WebApp.showPopup({
                title: 'ü§ù ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï',
                message: `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶è‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® ${REFERRAL_BONUS_POINTS} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü!`,
                buttons: [
                    { id: 'copy', type: 'default', text: '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®' },
                    { id: 'share', type: 'default', text: '‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®' },
                    { id: 'close', type: 'cancel', text: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®' }
                ]
            }, (buttonId) => {
                if (buttonId === 'copy') {
                    navigator.clipboard.writeText(referralLink).then(() => {
                        Telegram.WebApp.showAlert('‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                    });
                } else if (buttonId === 'share') {
                    Telegram.WebApp.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent('‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®! ')}`);
                }
            });
        }

        function openHistory() {
             Telegram.WebApp.showAlert('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá ‡¶Ü‡¶õ‡ßá‡•§');
        }

        function openSupport() { 
             Telegram.WebApp.showAlert(`üìû ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:\n\n‡¶´‡ßã‡¶®: ${CONTACT_NUMBER}\n‡¶á‡¶Æ‡ßá‡¶á‡¶≤: ${CONTACT_EMAIL}`); 
        }

        // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ---
        document.addEventListener('DOMContentLoaded', () => {
            if (loadTelegramUser()) {
                fetchUserData(); 
            }

            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        });
        
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnQuick Official</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* ‡¶â‡¶®‡ßç‡¶®‡¶§ CSS ‡¶Ø‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶ø‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø‡¶ï‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶ï‡¶∞‡ßá ‡¶§‡ßÅ‡¶≤‡¶¨‡ßá */
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: #f8f9fa; 
            padding: 0; 
            margin: 0; 
            min-height: 100vh;
        }
        .app-container { 
            width: 100%; 
            min-height: 100vh;
            margin: 0 auto; 
            background-color: #ffffff; 
            padding: 20px; 
            box-shadow: none; 
            box-sizing: border-box; 
        }
        .header { 
            text-align: center; 
            margin-bottom: 5px; 
            padding-top: 10px;
        }
        .tg-style { color: #007bff; font-weight: bold; } 

        /* ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶π‡ßá‡¶°‡¶≤‡¶æ‡¶á‡¶® (Marquee) ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .marquee-container {
            background-color: #ffeb3b; 
            border: 1px solid #ffb300;
            border-radius: 6px;
            padding: 5px 10px;
            color: #333;
            font-weight: bold;
            overflow: hidden; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 15px !important;
        }
        .marquee-text {
            font-size: 0.9rem;
            white-space: nowrap; 
        }

        /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞) */
        .ad-banner {
            width: 100%;
            height: 50px;
            background-color: #e0e0e0;
            border: 1px dashed #999;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }
        .ad-banner-bottom {
            margin-top: 20px;
        }


        /* ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
        .balance-card { 
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 6px 12px rgba(0, 50, 150, 0.2);
        }
        .balance-card h4, .balance-card p {
            margin-bottom: 5px;
        }
        .balance-card .tg-style {
            color: #ffeb3b; 
            font-weight: bold;
        }
        .btn-action { 
            margin: 8px 0; 
            width: 100%; 
            border-radius: 8px; 
            font-size: 1.1rem;
            padding: 12px;
        }
        .text-secondary.small {
            color: #ddd !important; 
        }
        .alert-custom { 
            margin-top: 15px; 
            border-radius: 8px;
        }
        .hidden { display: none; }
        
        /* Loading Spinner */
        .loading-spinner-area {
            text-align: center;
            padding: 50px 0;
            color: #007bff;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        /* Admin Button Style */
        #admin-button {
            background-color: #dc3545; 
            color: white;
            border-radius: 8px;
            font-size: 1.1rem;
            padding: 12px;
            margin-top: 15px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
          0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
          70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
          100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <div class="header">
        <h3 class="tg-style">üí∞ EarnQuick Official - ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h3>
        <p class="text-danger small">Telegram Mini App</p>
    </div>
    
    <div class="marquee-container">
        <marquee behavior="scroll" direction="left" scrollamount="4">
            <span class="marquee-text">
                ‚ö†Ô∏è ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ö‡¶≤‡¶õ‡ßá ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨:‡ß¶‡ß¶ ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßÆ:‡ß¶‡ß¶ ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§‡•§ üî• ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßá: üìû 01913621510 | üìß najmulh219653@gmail.com | üë§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: @najmulhoqueforhad
            </span>
        </marquee>
    </div>
    <div class="ad-banner" id="top-ad-banner">
        ‡¶è‡¶° ‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡ßß (Adsterra/Ads)
    </div>

    <div class="balance-card">
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span id="referral-count" class="tg-style">...</span> ‡¶ú‡¶®</p>
        <p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <span id="referral-bonus" class="tg-style">250</span> ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</p>
        <h4 class="mt-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="current-balance" class="tg-style">...</span></h4>
        <p class="text-secondary small mt-3">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: <span id="min-withdraw">10000</span> ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = 40 ‡¶ü‡¶æ‡¶ï‡¶æ</p>
    </div>

    <div id="loading-spinner" class="loading-spinner-area">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div id="main-content" class="hidden">
        <button id="admin-button" class="btn btn-danger btn-action hidden" onclick="showAdminPanel()">
            ADMIN: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡ßã ‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
        </button>

        <button class="btn btn-success btn-action" onclick="showAdTasks()">
            ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç 5 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
        <button class="btn btn-warning btn-action" data-toggle="modal" data-target="#withdrawModal">
            ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)
        </button>
        
        <hr>

        <p class="small text-center text-muted">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Æ‡ßá‡¶®‡ßÅ:</p>
        <button class="btn btn-info btn-sm btn-block" onclick="copyReferralLink()">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® (Refer)</button>
        <button class="btn btn-secondary btn-sm btn-block" onclick="alert('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶™‡ßá‡¶ú ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá!')">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</button>
    </div>

    <div id="ad-tasks" class="hidden my-4 p-3 border rounded">
        <h5>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï: ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h5>
        <p class="small text-muted">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá **5** ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü!</p>
        
        <button class="btn btn-outline-primary btn-sm btn-block mt-2" onclick="addPoints(5)">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ßß (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="addPoints(5)">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß® (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="addPoints(5)">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß© (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        
        <button class="btn btn-danger btn-action mt-3" onclick="hideAdTasks()">‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶® (Cancel)</button>
    </div>

    <div class="ad-banner ad-banner-bottom" id="bottom-ad-banner">
        ‡¶è‡¶° ‡¶™‡ßç‡¶≤‡ßá‡¶∏‡¶π‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡ß® (Adsterra/Ads)
    </div>

    <div id="admin-panel" class="hidden my-4 p-3 border rounded border-danger">
        <h5 class="text-danger">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h5>
        <p>‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡ßã ‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤)‡•§</p>
        <button class="btn btn-outline-danger btn-block" onclick="hideAdminPanel()">‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

</div>

<div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawModalLabel">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® (Withdraw)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="withdraw-form">
                    <div class="form-group">
                        <label for="points-to-withdraw">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü:</label>
                        <input type="number" class="form-control" id="points-to-withdraw" required min="10000">
                        <small class="form-text text-muted">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ 10,000 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</small>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø:</label>
                        <select class="form-control" id="payment-method" required>
                            <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ (Bkash)</option>
                            <option value="nagad">‡¶®‡¶ó‡¶¶ (Nagad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-number">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
                        <input type="text" class="form-control" id="payment-number" required>
                    </div>
                </form>
                <div id="withdraw-message" class="alert mt-3 hidden" role="alert"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button type="submit" form="withdraw-form" class="btn btn-success">‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Render ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ URL ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶® ‚ö†Ô∏è
    const SERVER_URL = 'https://smartearnbdbot.onrender.com';
    const REFERRAL_POINTS = 250;
    const MIN_WITHDRAWAL_POINTS = 10000;
    
    // üõë ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®
    const ADMIN_TELEGRAM_ID = '8145444675'; // Najmul Hoque Forhad ‡¶è‡¶∞ ID
    
    // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ (‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü)
    const WITHDRAWAL_START_HOUR = 6;   // ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨‡¶ü‡¶æ
    const WITHDRAWAL_END_HOUR = 20;    // ‡¶∞‡¶æ‡¶§ ‡ßÆ‡¶ü‡¶æ

    // --- Global Variables ---
    let currentUserId = null;
    let currentBalance = 0;
    let currentReferralCount = 0;
    let isAdmin = false;

    // --- Utility Functions ---
    function showMessage(type, message, duration = 3000) {
        const messageArea = document.getElementById('message-area');
        messageArea.className = `alert alert-${type} alert-custom`;
        messageArea.innerText = message;
        messageArea.classList.remove('hidden');
        setTimeout(() => {
            messageArea.classList.add('hidden');
        }, duration);
    }
    
    function isWithdrawalTime() {
        const now = new Date();
        const hour = now.getHours();
        return hour >= WITHDRAWAL_START_HOUR && hour < WITHDRAWAL_END_HOUR;
    }

    function updateBalanceDisplay(points, count) {
        currentBalance = points;
        currentReferralCount = count;
        document.getElementById('current-balance').innerText = points.toLocaleString('bn-BD');
        document.getElementById('referral-count').innerText = count;
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
        if (isAdmin) {
            document.getElementById('admin-button').classList.remove('hidden');
        } else {
            document.getElementById('admin-button').classList.add('hidden');
        }

        document.getElementById('loading-spinner').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
    }

    function getQueryParams() {
        const params = {};
        window.location.search.substring(1).split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) params[key] = decodeURIComponent(value || '');
        });
        return params;
    }

    // --- Core Logic ---

    // 1. Register or Check User 
    async function registerOrCheckUser() {
        const params = getQueryParams();
        let userId = params.uid || 'blogger_test_user_101'; 
        let refererId = params.ref || null;
        
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
            userId = window.Telegram.WebApp.initDataUnsafe.user.id.toString();
        } 
        // üõë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ö‡ßá‡¶ï
        if (userId === ADMIN_TELEGRAM_ID) {
            isAdmin = true;
        }

        currentUserId = userId;
        
        // ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡¶æ ‡¶π‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá API ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®
        if (userId !== 'blogger_test_user_101' || isAdmin) {
             try {
                const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, refererId })
                });
                const data = await response.json();

                if (data.success) {
                    updateBalanceDisplay(data.earned_points, data.referral_count);
                    if (data.message && data.message.includes('Referral bonus')) {
                        showMessage('success', data.message, 5000);
                    }
                } else {
                    showMessage('danger', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + (data.message || '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'));
                    document.getElementById('loading-spinner').classList.add('hidden');
                }
            } catch (error) {
                console.error('Registration/Check error:', error);
                showMessage('danger', '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø (500). ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                document.getElementById('loading-spinner').classList.add('hidden');
            }
        } else {
            // ‡¶Ø‡¶¶‡¶ø API ‡¶ï‡¶≤ ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶§‡¶¨‡ßá ‡¶°‡ßá‡¶Æ‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            updateBalanceDisplay(0, 0); 
            showMessage('warning', '‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ö‡¶≤‡¶õ‡ßá (‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)‡•§', 5000);
        }
    }

    // 2. Add Points (Simulating Ad Click)
    async function addPoints(points) {
        if (!currentUserId) {
            showMessage('danger', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/add_points`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, points })
            });
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount);
                showMessage('success', `${points} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
            } else {
                showMessage('danger', '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + data.message);
            }
        } catch (error) {
            console.error('Add points error:', error);
            showMessage('danger', '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§');
        }
    }
    
    // 3. Withdraw Request Submission (Time Check Added)
    document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pointsToWithdraw = parseInt(document.getElementById('points-to-withdraw').value);
        const paymentMethod = document.getElementById('payment-method').value;
        const paymentNumber = document.getElementById('payment-number').value;
        const withdrawMessageArea = document.getElementById('withdraw-message');
        
        withdrawMessageArea.classList.add('hidden');
        
        // üõë ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ö‡ßá‡¶ï
        if (!isWithdrawalTime()) {
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶ï‡¶æ‡¶≤ ${WITHDRAWAL_START_HOUR}:00 ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ${WITHDRAWAL_END_HOUR}:00 ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ö‡¶≤‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`;
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        if (pointsToWithdraw < MIN_WITHDRAWAL_POINTS || pointsToWithdraw > currentBalance) {
            withdrawMessageArea.className = 'alert alert-warning mt-3';
            withdrawMessageArea.innerText = '‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ï‡¶Æ‡•§';
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, pointsToWithdraw, paymentMethod, paymentNumber })
            });
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount);
                withdrawMessageArea.className = 'alert alert-success mt-3';
                withdrawMessageArea.innerText = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                withdrawMessageArea.classList.remove('hidden');
                
                // Hide modal after a delay
                setTimeout(() => {
                    $('#withdrawModal').modal('hide');
                    document.getElementById('withdraw-form').reset();
                }, 2000);

            } else {
                withdrawMessageArea.className = 'alert alert-danger mt-3';
                withdrawMessageArea.innerText = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + data.message;
                withdrawMessageArea.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Withdraw error:', error);
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§';
            withdrawMessageArea.classList.remove('hidden');
        }
    });

    // --- UI/Utility Functions ---
    function showAdTasks() {
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('ad-tasks').classList.remove('hidden');
    }
    
    function hideAdTasks() {
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    // --- Admin Panel Handlers (Placeholder) ---
    function showAdminPanel() {
        if (!isAdmin) return;
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        showMessage('danger', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');

        // Note: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶ï‡ßã‡¶° ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá (get_admin_stats, get_withdrawals)
    }

    function hideAdminPanel() {
        document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function copyReferralLink() {
        if (!currentUserId) {
            showMessage('warning', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§');
            return;
        }
        
        // ‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶≤‡¶ó‡¶æ‡¶∞ URL ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®
        const referralLink = `YOUR_BLOGGER_URL?ref=${currentUserId}`;
        
        navigator.clipboard.writeText(referralLink).then(() => {
            showMessage('info', '‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ' + referralLink);
        }).catch(err => {
            console.error('Copy failed:', err);
            showMessage('warning', '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        });
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Load Bootstrap JS dependencies for Modal functionality
        const script1 = document.createElement('script');
        script1.src = "https://code.jquery.com/jquery-3.5.1.slim.min.js";
        document.head.appendChild(script1);

        const script2 = document.createElement('script');
        script2.src = "https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js";
        document.head.appendChild(script2);

        const script3 = document.createElement('script');
        script3.src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js";
        document.head.appendChild(script3);

        // Wait for DOM to load, then check user
        registerOrCheckUser();
    });

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnQuick Official</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* [‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá - ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶ï‡ßã‡¶° ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§] */
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: #f8f9fa; 
            padding: 0; 
            margin: 0; 
            min-height: 100vh;
        }
        .app-container { 
            width: 100%; 
            min-height: 100vh;
            margin: 0 auto; 
            background-color: #ffffff; 
            padding: 20px; 
            box-shadow: none; 
            box-sizing: border-box; 
        }
        .header { 
            text-align: center; 
            margin-bottom: 5px; 
            padding-top: 10px;
        }
        .tg-style { color: #007bff; font-weight: bold; } 

        /* ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶π‡ßá‡¶°‡¶≤‡¶æ‡¶á‡¶® (Marquee) ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .marquee-container {
            background-color: #ffeb3b; 
            border: 1px solid #ffb300;
            border-radius: 6px;
            padding: 5px 10px;
            color: #333;
            font-weight: bold;
            overflow: hidden; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 15px !important;
        }
        .marquee-text {
            font-size: 0.9rem;
            white-space: nowrap; 
        }

        /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .ad-banner {
            width: 100%;
            min-height: 50px; 
            background-color: #e0e0e0;
            border: 1px dashed #999;
            text-align: center;
            line-height: 50px; 
            margin-bottom: 20px;
            overflow: hidden; 
        }
        .ad-banner-bottom {
            margin-top: 20px;
        }


        /* ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
        .balance-card { 
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 6px 12px rgba(0, 50, 150, 0.2);
        }
        .balance-card h4, .balance-card p {
            margin-bottom: 5px;
        }
        .balance-card .tg-style {
            color: #ffeb3b; 
            font-weight: bold;
        }
        .btn-action { 
            margin: 8px 0; 
            width: 100%; 
            border-radius: 8px; 
            font-size: 1.1rem;
            padding: 12px;
        }
        .text-secondary.small {
            color: #ddd !important; 
        }
        .alert-custom { 
            margin-top: 15px; 
            border-radius: 8px;
        }
        .hidden { display: none; }
        
        /* Loading Spinner */
        .loading-spinner-area {
            text-align: center;
            padding: 50px 0;
            color: #007bff;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        /* Admin Button Style */
        #admin-button {
            background-color: #dc3545; 
            color: white;
            border-radius: 8px;
            font-size: 1.1rem;
            padding: 12px;
            margin-top: 15px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
          0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
          70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
          100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
    </style>
    
    <script src='//libtl.com/sdk.js' async></script>

</head>
<body>

<div class="app-container">
    
    <div class="header">
        <h3 class="tg-style">üí∞ EarnQuick Official - ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h3>
        <p class="text-danger small">Telegram Mini App</p>
    </div>
    
    <div class="marquee-container">
        <marquee behavior="scroll" direction="left" scrollamount="4">
            <span class="marquee-text">
                ‚ö†Ô∏è ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ö‡¶≤‡¶õ‡ßá ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨:‡ß¶‡ß¶ ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßÆ:‡ß¶‡ß¶ ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§‡•§ üî• ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßá: üìû 01913621510 | üìß najmulh219653@gmail.com | üë§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: @najmulhoqueforhad
            </span>
        </marquee>
    </div>
    <div class="ad-banner" id="top-ad-banner" style="height: 90px; line-height: normal;">
        <script type="text/javascript"> 	atOptions = { 		'key' : '00605022df81b880d400151bfc7c2185', 		'format' : 'iframe', 		'height' : 90, 		'width' : 728, 		'params' : {} 	}; </script> <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
    </div>

    <div class="balance-card">
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span id="referral-count" class="tg-style">...</span> ‡¶ú‡¶®</p>
        <p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <span id="referral-bonus" class="tg-style">250</span> ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</p>
        <h4 class="mt-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="current-balance" class="tg-style">...</span></h4>
        <p class="text-secondary small mt-3">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: <span id="min-withdraw">10000</span> ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = 40 ‡¶ü‡¶æ‡¶ï‡¶æ</p>
    </div>

    <div id="loading-spinner" class="loading-spinner-area">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div id="main-content" class="hidden">
        <button id="admin-button" class="btn btn-danger btn-action hidden" onclick="showAdminPanel()">
            ADMIN: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡ßã ‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
        </button>

        <button class="btn btn-success btn-action" onclick="showAdTasks()">
            ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç 5 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
        <button class="btn btn-warning btn-action" data-toggle="modal" data-target="#withdrawModal">
            ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)
        </button>
        
        <hr>

        <p class="small text-center text-muted">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Æ‡ßá‡¶®‡ßÅ:</p>
        <button class="btn btn-info btn-sm btn-block" onclick="copyReferralLink()">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® (Refer)</button>
        <button class="btn btn-secondary btn-sm btn-block" onclick="alert('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶™‡ßá‡¶ú ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá!')">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</button>
    </div>

    <div id="ad-tasks" class="hidden my-4 p-3 border rounded">
        <h5>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï: ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h5>
        <p class="small text-muted">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá **5** ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá‡¶á ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§</p>
        
        <button class="btn btn-outline-primary btn-sm btn-block mt-2" onclick="loadAdTask(1, 5);">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ßß (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="loadAdTask(2, 5);">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß® (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="loadAdTask(3, 5);">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß© (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        
        <button class="btn btn-danger btn-action mt-3" onclick="hideAdTasks()">‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶® (Cancel)</button>
    </div>

    <div class="ad-banner ad-banner-bottom" id="bottom-ad-banner" style="height: 90px; line-height: normal;">
        <script type="text/javascript"> 	atOptions = { 		'key' : '00605022df81b880d400151bfc7c2185', 		'format' : 'iframe', 		'height' : 90, 		'width' : 728, 		'params' : {} 	}; </script> <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
    </div>

    <div id="admin-panel" class="hidden my-4 p-3 border rounded border-danger">
        <h5 class="text-danger">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h5>
        <p>‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶á‡¶®‡¶´‡ßã ‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤)‡•§</p>
        <button class="btn btn-outline-danger btn-block" onclick="hideAdminPanel()">‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

</div>

<div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawModalLabel">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® (Withdraw)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="withdraw-form">
                    <div class="form-group">
                        <label for="points-to-withdraw">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü:</label>
                        <input type="number" class="form-control" id="points-to-withdraw" required min="10000">
                        <small class="form-text text-muted">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ 10,000 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</small>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø:</label>
                        <select class="form-control" id="payment-method" required>
                            <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ (Bkash)</option>
                            <option value="nagad">‡¶®‡¶ó‡¶¶ (Nagad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-number">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
                        <input type="text" class="form-control" id="payment-number" required>
                    </div>
                </form>
                <div id="withdraw-message" class="alert mt-3 hidden" role="alert"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button type="submit" form="withdraw-form" class="btn btn-success">‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Render ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ URL ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶® ‚ö†Ô∏è
    const SERVER_URL = 'https://smartearnbdbot.onrender.com';
    const REFERRAL_POINTS = 250;
    const MIN_WITHDRAWAL_POINTS = 10000;
    
    // üõë ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶®
    const ADMIN_TELEGRAM_ID = '8145444675'; 
    
    // ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶≤‡¶ó‡¶æ‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø
    const BLOGGER_TEST_ID = 'blogger_test_user_101'; 

    // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ (‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü)
    const WITHDRAWAL_START_HOUR = 6;   // ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨‡¶ü‡¶æ
    const WITHDRAWAL_END_HOUR = 20;    // ‡¶∞‡¶æ‡¶§ ‡ßÆ‡¶ü‡¶æ

    // ‡¶Æ‡¶®‡¶ø‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ú‡ßã‡¶® ‡¶Ü‡¶á‡¶°‡¶ø
    const MONETAG_ZONES = {
        1: '10085320', // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ßß
        2: '10070523', // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß®
        3: '9852420'   // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß©
    };

    // --- Global Variables ---
    let currentUserId = null;
    let currentBalance = 0;
    let currentReferralCount = 0;
    let isAdmin = false;
    let currentUsername = null;
    let currentFirstName = null;


    // --- Utility Functions ---
    function showMessage(type, message, duration = 3000) {
        let messageArea = document.getElementById('global-message-area');
        if (!messageArea) {
            messageArea = document.createElement('div');
            messageArea.id = 'global-message-area';
            document.querySelector('.app-container').prepend(messageArea);
        }
        
        messageArea.className = `alert alert-${type} alert-custom`;
        messageArea.innerText = message;
        messageArea.classList.remove('hidden');
        
        setTimeout(() => {
            messageArea.classList.add('hidden');
        }, duration);
    }
    
    function isWithdrawalTime() {
        const now = new Date();
        const hour = now.getHours();
        return hour >= WITHDRAWAL_START_HOUR && hour < WITHDRAWAL_END_HOUR;
    }

    function updateBalanceDisplay(points, count) {
        currentBalance = points;
        currentReferralCount = count;
        document.getElementById('current-balance').innerText = points.toLocaleString('bn-BD');
        document.getElementById('referral-count').innerText = count;
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
        if (isAdmin) {
            document.getElementById('admin-button').classList.remove('hidden');
        } else {
            document.getElementById('admin-button').classList.add('hidden');
        }

        document.getElementById('loading-spinner').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
    }

    function getQueryParams() {
        const params = {};
        window.location.search.substring(1).split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) params[key] = decodeURIComponent(value || '');
        });
        return params;
    }

    // --- Core Logic ---

    // 1. Register or Check User 
    async function registerOrCheckUser() {
        const params = getQueryParams();
        let userId = params.uid || BLOGGER_TEST_ID; 
        let refererId = params.ref || null;
        let username = null;
        let firstName = null;

        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Æ‡¶ø‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
            const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
            userId = tgUser.id.toString();
            username = tgUser.username || null;
            firstName = tgUser.first_name || null;
        } 
        
        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        currentUserId = userId;
        currentUsername = username;
        currentFirstName = firstName;
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ö‡ßá‡¶ï: ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç ‡¶Ü‡¶á‡¶°‡¶ø‡¶ï‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶≤‡ßã
        if (currentUserId === ADMIN_TELEGRAM_ID || currentUserId === BLOGGER_TEST_ID) {
            isAdmin = true;
        }

        // API ‡¶ï‡¶≤: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
        try {
            const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, refererId, username: currentUsername, firstName: currentFirstName })
            });

            if (!response.ok) {
                // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá‡¶ì API ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø
                const errorData = await response.json();
                throw new Error(`API Error: ${errorData.message || 'Unknown Server Error'}`);
            }

            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.earned_points, data.referral_count);
                showMessage('success', '‚úÖ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡•§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            } else {
                showMessage('warning', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + (data.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶≤‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'));
                document.getElementById('loading-spinner').classList.add('hidden');
            }
        } catch (error) {
            console.error('Registration/Check error:', error);
            // üõë ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ
            updateBalanceDisplay(0, 0); // ‡¶°‡ßá‡¶Æ‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            showMessage('danger', `‚ùå ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ${error.message || '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ GitHub/Render ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'}`);
            document.getElementById('loading-spinner').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        }
    }

    // 2. Add Points (API Call)
    async function addPoints(points) {
        if (!currentUserId || currentUserId === BLOGGER_TEST_ID) {
            showMessage('danger', '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶Ü‡¶∏‡¶≤ Telegram ID ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/add_points`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, points })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API Error: ${errorData.message || 'Unknown Server Error'}`);
            }
            
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount);
                showMessage('success', `‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßá‡¶∑‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡•§ ${points} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
            } else {
                showMessage('danger', '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + (data.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶ï‡¶æ‡¶∞‡¶£'));
            }
        } catch (error) {
            console.error('Add points error:', error);
            showMessage('danger', `‚ùå ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`);
        }
    }
    
    // 4. Monetag Ad Loading Function (Reward Granting Logic)
    function loadAdTask(adNumber, points) {
        const zoneId = MONETAG_ZONES[adNumber];
        if (!zoneId) return;
        
        showMessage('info', `Monetag/Libtl ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá (Zone: ${zoneId})‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...`);

        // Monettag-‡¶è‡¶∞ show_XXX ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø‡¶ï‡ßá ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        const showFunctionName = `show_${zoneId}`;

        if (window[showFunctionName]) {
            // ymid ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá (‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
            window[showFunctionName]({ ymid: currentUserId })
                .then(() => {
                    console.log(`Ad ${adNumber} finished successfully.`);
                    // üõë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ API ‡¶ï‡¶≤
                    addPoints(points); 
                })
                .catch((error) => {
                    console.error(`Ad ${adNumber} failed or skipped:`, error);
                    showMessage('warning', `‚ö†Ô∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø ‡¶¨‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ${points} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§`);
                });
        } else {
            showMessage('danger', `Monetag SDK ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
        }
    }

    // 3. Withdraw Request Submission (No Change)
    document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pointsToWithdraw = parseInt(document.getElementById('points-to-withdraw').value);
        const paymentMethod = document.getElementById('payment-method').value;
        const paymentNumber = document.getElementById('payment-number').value;
        const withdrawMessageArea = document.getElementById('withdraw-message');
        
        withdrawMessageArea.classList.add('hidden');
        
        if (!isWithdrawalTime()) {
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶ï‡¶æ‡¶≤ ${WITHDRAWAL_START_HOUR}:00 ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ${WITHDRAWAL_END_HOUR}:00 ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ö‡¶≤‡ßá‡•§`;
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        if (pointsToWithdraw < MIN_WITHDRAWAL_POINTS || pointsToWithdraw > currentBalance) {
            withdrawMessageArea.className = 'alert alert-warning mt-3';
            withdrawMessageArea.innerText = '‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ï‡¶Æ‡•§';
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, pointsToWithdraw, paymentMethod, paymentNumber })
            });
            
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount);
                withdrawMessageArea.className = 'alert alert-success mt-3';
                withdrawMessageArea.innerText = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                withdrawMessageArea.classList.remove('hidden');
                
                setTimeout(() => {
                    $('#withdrawModal').modal('hide');
                    document.getElementById('withdraw-form').reset();
                }, 2000);

            } else {
                withdrawMessageArea.className = 'alert alert-danger mt-3';
                withdrawMessageArea.innerText = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + data.message;
                withdrawMessageArea.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Withdraw error:', error);
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§';
            withdrawMessageArea.classList.remove('hidden');
        }
    });


    // --- UI/Utility Functions (No Change) ---
    function showAdTasks() {
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('ad-tasks').classList.remove('hidden');
    }
    
    function hideAdTasks() {
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function showAdminPanel() {
        if (!isAdmin) return;
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        showMessage('danger', '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
    }

    function hideAdminPanel() {
        document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function copyReferralLink() {
        if (!currentUserId) {
            showMessage('warning', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§');
            return;
        }
        
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü ‡¶è‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
        const referralLink = `https://t.me/EarnQuick_Official_‡¶¨‡¶§/start?ref=${currentUserId}`;
        
        navigator.clipboard.writeText(referralLink).then(() => {
            showMessage('info', '‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ' + referralLink);
        }).catch(err => {
            console.error('Copy failed:', err);
            showMessage('warning', '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        });
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Load Bootstrap JS dependencies for Modal functionality
        // Note: These need to load first for Bootstrap's modal/dropdown to work
        
        // JQuery (Needed for Bootstrap 4)
        const script1 = document.createElement('script');
        script1.src = "https://code.jquery.com/jquery-3.5.1.slim.min.js";
        document.head.appendChild(script1);

        // Popper.js (Needed for Bootstrap 4)
        const script2 = document.createElement('script');
        script2.src = "https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js";
        document.head.appendChild(script2);

        // Bootstrap JS
        const script3 = document.createElement('script');
        script3.src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js";
        document.head.appendChild(script3);

        // Wait for all scripts to load, then check user
        // We set a small timeout to ensure the external scripts (JQuery, Popper, BS) load
        setTimeout(() => {
            registerOrCheckUser();
        }, 300); 
    });

</script>
</body>
</html>

<div style="max-width: 600px; margin: 0 auto;"> 
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    /* [‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã] */
    body { 
        font-family: 'Arial', sans-serif; 
        background-color: #f8f9fa; 
        padding: 0; 
        margin: 0; 
        min-height: 100vh;
        -ms-overflow-style: none;  
        scrollbar-width: none;  
    }
    body::-webkit-scrollbar {
        display: none;
    }

    .app-container { 
        width: 100%; 
        min-height: 100vh;
        margin: 0 auto; 
        background-color: #ffffff; 
        padding: 20px; 
        box-shadow: none; 
        box-sizing: border-box; 
    }
    .header { 
        text-align: center; 
        margin-bottom: 5px; 
        padding-top: 10px;
    }
    .tg-style { color: #007bff; font-weight: bold; } 

    /* ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶π‡ßá‡¶°‡¶≤‡¶æ‡¶á‡¶® (Marquee) ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    .marquee-container {
        background-color: #ffeb3b; 
        border: 1px solid #ffb300;
        border-radius: 6px;
        padding: 5px 10px;
        color: #333;
        font-weight: bold;
        overflow: hidden; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 15px !important;
    }
    .marquee-text {
        font-size: 0.9rem;
        white-space: nowrap; 
    }

    /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
    .ad-banner {
        width: 100%;
        min-height: 50px; 
        background-color: #e0e0e0;
        border: 1px dashed #999;
        text-align: center;
        line-height: 50px; 
        margin-bottom: 20px;
        overflow: hidden; 
    }
    .ad-banner-bottom {
        margin-top: 20px;
    }

    /* ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° */
    .balance-card { 
        background: linear-gradient(135deg, #007bff, #0056b3); 
        color: white; 
        border-radius: 12px; 
        padding: 20px; 
        margin-bottom: 20px; 
        box-shadow: 0 6px 12px rgba(0, 50, 150, 0.2);
    }
    .balance-card h4, .balance-card p {
        margin-bottom: 5px;
    }
    .balance-card .tg-style {
        color: #ffeb3b; 
        font-weight: bold;
    }
    .btn-action { 
        margin: 8px 0; 
        width: 100%; 
        border-radius: 8px; 
        font-size: 1.1rem;
        padding: 12px;
    }
    .text-secondary.small {
        color: #ddd !important; 
    }
    .alert-custom { 
        margin-top: 15px; 
        border-radius: 8px;
    }
    .hidden { display: none; }
    
    /* Loading Spinner */
    .loading-spinner-area {
        text-align: center;
        padding: 50px 0;
        color: #007bff;
    }
    .spinner-border {
        width: 3rem;
        height: 3rem;
        border-width: 0.3em;
    }
    
    /* Admin Button Style */
    #admin-button {
        background-color: #dc3545; 
        color: white;
        border-radius: 8px;
        font-size: 1.1rem;
        padding: 12px;
        margin-top: 15px;
        font-weight: bold;
        animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
      100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }
    /* Admin Table Styling */
    .admin-table-container {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-top: 10px;
    }
    .admin-table-container table {
        margin-bottom: 0;
    }
</style>

<script src='//libtl.com/sdk.js' async></script>

<div class="app-container">
    
    <div class="header">
        <h3 class="tg-style">üí∞ EarnQuick Official - ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h3>
        <p class="text-danger small">Telegram Mini App</p>
    </div>
    
    <div class="marquee-container">
        <marquee behavior="scroll" direction="left" scrollamount="4">
            <span class="marquee-text">
                üëâ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá 250 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®! ‚ö†Ô∏è ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ö‡¶≤‡¶õ‡ßá ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨:‡ß¶‡ß¶ ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßÆ:‡ß¶‡ß¶ ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§‡•§ üî• ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßá: üìû 01913621510 | üìß najmulh219653@gmail.com | üë§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: @najmulhoqueforhad
            </span>
        </marquee>
    </div>
    <div class="ad-banner" id="top-ad-banner" style="height: 90px; line-height: normal;">
        <script type="text/javascript"> 	atOptions = { 		'key' : '00605022df81b880d400151bfc7c2185', 		'format' : 'iframe', 		'height' : 90, 		'width' : 728, 		'params' : {} 	}; </script> <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
    </div>

    <div class="balance-card">
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span id="referral-count" class="tg-style">...</span> ‡¶ú‡¶®</p>
        <p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <span id="referral-bonus" class="tg-style">250</span> ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</p>
        <h4 class="mt-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="current-balance" class="tg-style">...</span></h4>
        <p class="text-secondary small mt-3">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: <span id="min-withdraw">10000</span> ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = 40 ‡¶ü‡¶æ‡¶ï‡¶æ</p>
    </div>

    <div id="loading-spinner" class="loading-spinner-area">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div id="main-content" class="hidden">
        <button id="admin-button" class="btn btn-danger btn-action hidden" onclick="showAdminPanel()">
            ADMIN: ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
        </button>

        <button class="btn btn-success btn-action" onclick="showAdTasks()">
            ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç 5 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
        <button class="btn btn-warning btn-action" data-toggle="modal" data-target="#withdrawModal">
            ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)
        </button>
        
        <hr>

        <p class="small text-center text-muted">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Æ‡ßá‡¶®‡ßÅ:</p>
        <button class="btn btn-info btn-sm btn-block" onclick="copyReferralLink()">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® (Refer)</button>
        <button class="btn btn-secondary btn-sm btn-block" onclick="alert('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶™‡ßá‡¶ú ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá!')">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</button>
    </div>

    <div id="ad-tasks" class="hidden my-4 p-3 border rounded">
        <h5>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï: ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h5>
        <p class="small text-muted">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá **5** ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá‡¶á ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§</p>
        
        <button class="btn btn-outline-primary btn-sm btn-block mt-2" onclick="loadAdTask(1, 5);">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ßß (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="loadAdTask(2, 5);">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß® (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="loadAdTask(3, 5);">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡ß© (‡ß´ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)</button>
        
        <button class="btn btn-danger btn-action mt-3" onclick="hideAdTasks()">‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶® (Cancel)</button>
    </div>

    <div class="ad-banner ad-banner-bottom" id="bottom-ad-banner" style="height: 90px; line-height: normal;">
        <script type="text/javascript"> 	atOptions = { 		'key' : '00605022df81b880d400151bfc7c2185', 		'format' : 'iframe', 		'height' : 90, 		'width' : 728, 		'params' : {} 	}; </script> <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
    </div>

    <div id="admin-panel" class="hidden my-4 p-3 border rounded border-danger">
        <h5 class="text-danger">üõë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤: ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ</h5>
        <div id="admin-data-loader" class="text-center p-3">
             <div class="spinner-border spinner-border-sm text-danger" role="status"></div>
             <p class="small mt-2">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
        
        <h6 class="mt-3 text-primary">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü:</h6>
        <div id="pending-withdrawals-data" class="admin-table-container">
            <p class="text-muted small p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</p>
        </div>

        <h6 class="mt-4 text-primary">‡¶∂‡ßÄ‡¶∞‡ßç‡¶∑ ‡ßß‡ß¶‡ß¶ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ (‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ):</h6>
        <div id="top-users-data" class="admin-table-container">
            <p class="text-muted small p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§</p>
        </div>

        <button class="btn btn-outline-danger btn-block mt-4" onclick="hideAdminPanel()">‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

</div>

<div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawModalLabel">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® (Withdraw)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="withdraw-form">
                    <div class="form-group">
                        <label for="points-to-withdraw">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü:</label>
                        <input type="number" class="form-control" id="points-to-withdraw" required min="10000">
                        <small class="form-text text-muted">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ 10,000 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</small>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø:</label>
                        <select class="form-control" id="payment-method" required>
                            <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ (Bkash)</option>
                            <option value="nagad">‡¶®‡¶ó‡¶¶ (Nagad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-number">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
                        <input type="text" class="form-control" id="payment-number" required>
                    </div>
                </form>
                <div id="withdraw-message" class="alert mt-3 hidden" role="alert"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button type="submit" form="withdraw-form" class="btn btn-success">‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
        </div>
    </div>
</div>

<script>
    const SERVER_URL = 'https://smartearnbdbot.onrender.com';
    const MIN_WITHDRAWAL_POINTS = 10000;
    
    // üõë ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡ßá ‡¶è‡¶á ‡¶Ü‡¶á‡¶°‡¶ø‡¶ü‡¶ø server.js-‡¶è‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶≤‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º 
    const ADMIN_TELEGRAM_ID = '8145444675'; 
    const BLOGGER_TEST_ID = 'blogger_test_user_101'; 

    const WITHDRAWAL_START_HOUR = 6;   
    const WITHDRAWAL_END_HOUR = 20;    

    const MONETAG_ZONES = {
        1: '10085320', 
        2: '10070523', 
        3: '9852420'   
    };

    // --- Global Variables ---
    let currentUserId = null;
    let currentBalance = 0;
    let currentReferralCount = 0;
    let isAdmin = false;

    // --- Utility Functions ---
    function showMessage(type, message, duration = 3000) {
        let messageArea = document.getElementById('global-message-area');
        if (!messageArea) {
            messageArea = document.createElement('div');
            messageArea.id = 'global-message-area';
            document.querySelector('.app-container').prepend(messageArea);
        }
        
        messageArea.className = `alert alert-${type} alert-custom`;
        messageArea.innerText = message;
        messageArea.classList.remove('hidden');
        
        setTimeout(() => {
            messageArea.classList.add('hidden');
        }, duration);
    }

    function updateBalanceDisplay(points, count, userIsAdmin) {
        currentBalance = points;
        currentReferralCount = count;
        isAdmin = userIsAdmin; // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        
        document.getElementById('current-balance').innerText = points.toLocaleString('bn-BD');
        document.getElementById('referral-count').innerText = count;
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì/‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
        if (isAdmin) {
            document.getElementById('admin-button').classList.remove('hidden');
        } else {
            document.getElementById('admin-button').classList.add('hidden');
        }

        document.getElementById('loading-spinner').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
    }

    function getQueryParams() {
        const params = {};
        window.location.search.substring(1).split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) params[key] = decodeURIComponent(value || '');
        });
        return params;
    }

    // --- Core Logic ---

    async function registerOrCheckUser() {
        const params = getQueryParams();
        let userId = params.uid || BLOGGER_TEST_ID; 
        let refererId = params.ref || null;
        let username = null;
        let firstName = null;

        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
            const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
            userId = tgUser.id.toString();
            username = tgUser.username || null;
            firstName = tgUser.first_name || null;
        } 
        
        currentUserId = userId;

        try {
            const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, refererId, username, firstName })
            });

            const data = await response.json();

            if (data.success) {
                // is_admin ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                updateBalanceDisplay(data.earned_points, data.referral_count, data.is_admin);
                showMessage('success', '‚úÖ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡•§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            } else {
                updateBalanceDisplay(0, 0, false);
                showMessage('warning', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + (data.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§'));
            }
        } catch (error) {
            console.error('Registration/Check error:', error);
            updateBalanceDisplay(0, 0, false); 
            showMessage('danger', `‚ùå ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ${error.message || '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ GitHub/Render ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'}`);
        }
    }
    
    // üõë ‡¶®‡¶§‡ßÅ‡¶®: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    async function loadAdminData() {
        const loader = document.getElementById('admin-data-loader');
        const usersContainer = document.getElementById('top-users-data');
        const withdrawalsContainer = document.getElementById('pending-withdrawals-data');
        
        loader.classList.remove('hidden');
        usersContainer.innerHTML = '';
        withdrawalsContainer.innerHTML = '';

        try {
            const response = await fetch(`${SERVER_URL}/api/admin/data/${currentUserId}`);

            if (response.status === 403) {
                showMessage('danger', 'üõë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶®‡ßá‡¶á‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶®‡¶®‡•§');
                hideAdminPanel();
                return;
            }

            if (!response.ok) {
                throw new Error('Failed to fetch admin data from server.');
            }

            const data = await response.json();

            if (data.success) {
                renderUsersTable(data.users, usersContainer);
                renderWithdrawalsTable(data.pendingWithdrawals, withdrawalsContainer);
                showMessage('success', '‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            } else {
                showMessage('warning', '‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + (data.message || '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§'));
            }

        } catch (error) {
            console.error('Admin data load error:', error);
            showMessage('danger', `‚ùå ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`);
        } finally {
            loader.classList.add('hidden');
        }
    }
    
    function renderUsersTable(users, container) {
        if (users.length === 0) {
            container.innerHTML = '<p class="text-muted small p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
            return;
        }

        let tableHtml = `
            <table class="table table-sm table-striped small">
                <thead>
                    <tr class="bg-primary text-white">
                        <th>#</th>
                        <th>ID / Username</th>
                        <th>Points</th>
                        <th>Ref. Count</th>
                    </tr>
                </thead>
                <tbody>
        `;

        users.forEach((user, index) => {
            const usernameDisplay = user.telegram_username ? `@${user.telegram_username}` : (user.first_name || 'N/A');
            tableHtml += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${usernameDisplay} (ID: ${user.telegram_user_id})</td>
                    <td>${Math.floor(user.earned_points).toLocaleString('bn-BD')}</td>
                    <td>${user.referral_count}</td>
                </tr>
            `;
        });

        tableHtml += `</tbody></table>`;
        container.innerHTML = tableHtml;
    }

    function renderWithdrawalsTable(withdrawals, container) {
        if (withdrawals.length === 0) {
            container.innerHTML = '<p class="text-muted small p-2">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</p>';
            return;
        }

        let tableHtml = `
            <table class="table table-sm table-striped small">
                <thead>
                    <tr class="bg-warning text-dark">
                        <th>ID</th>
                        <th>User ID</th>
                        <th>Points</th>
                        <th>Method/Num</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
        `;

        withdrawals.forEach((req) => {
            const time = new Date(req.requested_at).toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', hour12: true });
            tableHtml += `
                <tr>
                    <td>${req.request_id}</td>
                    <td>${req.telegram_user_id}</td>
                    <td>${Math.floor(req.points_requested).toLocaleString('bn-BD')}</td>
                    <td>${req.payment_method} / ${req.payment_number}</td>
                    <td>${time}</td>
                </tr>
            `;
        });

        tableHtml += `</tbody></table>`;
        container.innerHTML = tableHtml;
    }

    async function addPoints(points) {
        if (!currentUserId || currentUserId === BLOGGER_TEST_ID) {
            showMessage('danger', '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶Ü‡¶∏‡¶≤ Telegram ID ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/add_points`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, points })
            });
            
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount, isAdmin);
                showMessage('success', `‚úÖ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∂‡ßá‡¶∑‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶´‡¶≤‡•§ ${points} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
            } else {
                showMessage('danger', '‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + (data.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶ï‡¶æ‡¶∞‡¶£'));
            }
        } catch (error) {
            console.error('Add points error:', error);
            showMessage('danger', `‚ùå ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${error.message}`);
        }
    }
    
    function loadAdTask(adNumber, points) {
        const zoneId = MONETAG_ZONES[adNumber];
        if (!zoneId) return;
        
        showMessage('info', `Monetag/Libtl ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá (Zone: ${zoneId})‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...`);

        const showFunctionName = `show_${zoneId}`;

        if (window[showFunctionName]) {
            window[showFunctionName]({ ymid: currentUserId })
                .then(() => {
                    console.log(`Ad ${adNumber} finished successfully.`);
                    addPoints(points); 
                })
                .catch((error) => {
                    console.error(`Ad ${adNumber} failed or skipped:`, error);
                    showMessage('warning', `‚ö†Ô∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø ‡¶¨‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ${points} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§`);
                });
        } else {
            showMessage('danger', `Monetag SDK ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
        }
    }

    document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pointsToWithdraw = parseInt(document.getElementById('points-to-withdraw').value);
        const paymentMethod = document.getElementById('payment-method').value;
        const paymentNumber = document.getElementById('payment-number').value;
        const withdrawMessageArea = document.getElementById('withdraw-message');
        
        withdrawMessageArea.classList.add('hidden');
        
        // ... (‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ...
        const isWithdrawalTime = () => {
             const now = new Date();
             const hour = now.getHours();
             return hour >= WITHDRAWAL_START_HOUR && hour < WITHDRAWAL_END_HOUR;
        };

        if (!isWithdrawalTime()) {
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶ï‡¶æ‡¶≤ ${WITHDRAWAL_START_HOUR}:00 ‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ${WITHDRAWAL_END_HOUR}:00 ‡¶ü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶ö‡¶≤‡ßá‡•§`;
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        if (pointsToWithdraw < MIN_WITHDRAWAL_POINTS || pointsToWithdraw > currentBalance) {
            withdrawMessageArea.className = 'alert alert-warning mt-3';
            withdrawMessageArea.innerText = '‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶ï‡¶Æ‡•§';
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, pointsToWithdraw, paymentMethod, paymentNumber })
            });
            
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount, isAdmin);
                withdrawMessageArea.className = 'alert alert-success mt-3';
                withdrawMessageArea.innerText = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                withdrawMessageArea.classList.remove('hidden');
                
                setTimeout(() => {
                    $('#withdrawModal').modal('hide'); 
                    document.getElementById('withdraw-form').reset();
                }, 2000);

            } else {
                withdrawMessageArea.className = 'alert alert-danger mt-3';
                withdrawMessageArea.innerText = '‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + data.message;
                withdrawMessageArea.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Withdraw error:', error);
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = '‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§';
            withdrawMessageArea.classList.remove('hidden');
        }
    });

    // --- UI/Utility Functions ---
    function showAdTasks() {
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('ad-tasks').classList.remove('hidden');
    }
    
    function hideAdTasks() {
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function showAdminPanel() {
        if (!isAdmin) {
             showMessage('danger', 'üõë ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶®‡ßá‡¶á‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶®‡¶®‡•§');
             return;
        }
        
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        
        // ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        loadAdminData();
    }

    function hideAdminPanel() {
        document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function copyReferralLink() {
        if (!currentUserId) {
            showMessage('warning', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§');
            return;
        }
        
        const referralLink = `https://t.me/EarnQuick_Official_‡¶¨‡¶§/start?ref=${currentUserId}`;
        
        navigator.clipboard.writeText(referralLink).then(() => {
            showMessage('info', '‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ' + referralLink);
        }).catch(err => {
            console.error('Copy failed:', err);
            showMessage('warning', '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        });
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Load JS dependencies
        const script1 = document.createElement('script');
        script1.src = "https://code.jquery.com/jquery-3.5.1.slim.min.js";
        document.head.appendChild(script1);

        const script2 = document.createElement('script');
        script2.src = "https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js";
        document.head.appendChild(script2);

        const script3 = document.createElement('script');
        script3.src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js";
        document.head.appendChild(script3);

        setTimeout(() => {
            registerOrCheckUser();
        }, 300); 
    });

</script>
</div>

<div style="max-width: 600px; margin: 0 auto;"> 
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    /* [рж╕рзНржХрзНрж░рж▓ржмрж╛рж░ рж▓рзБржХрж╛ржирзЛ] */
    body { 
        font-family: 'Arial', sans-serif; 
        background-color: #f8f9fa; 
        padding: 0; 
        margin: 0; 
        min-height: 100vh;
        -ms-overflow-style: none;  
        scrollbar-width: none;  
    }
    body::-webkit-scrollbar {
        display: none;
    }

    .app-container { 
        width: 100%; 
        min-height: 100vh;
        margin: 0 auto; 
        background-color: #ffffff; 
        padding: 20px; 
        box-shadow: none; 
        box-sizing: border-box; 
    }
    .header { 
        text-align: center; 
        margin-bottom: 5px; 
        padding-top: 10px;
    }
    .tg-style { color: #007bff; font-weight: bold; } 

    /* ржЪрж▓ржорж╛ржи рж╣рзЗржбрж▓рж╛ржЗржи (Marquee) рж╕рзНржЯрж╛ржЗрж▓ */
    .marquee-container {
        background-color: #ffeb3b; 
        border: 1px solid #ffb300;
        border-radius: 6px;
        padding: 5px 10px;
        color: #333;
        font-weight: bold;
        overflow: hidden; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 15px !important;
    }
    .marquee-text {
        font-size: 0.9rem;
        white-space: nowrap; 
    }

    /* ржЕрзНржпрж╛ржб ржмрзНржпрж╛ржирж╛рж░ рж╕рзНржЯрж╛ржЗрж▓ */
    .ad-banner {
        width: 100%;
        min-height: 50px; 
        background-color: #e0e0e0;
        border: 1px dashed #999;
        text-align: center;
        line-height: 50px; 
        margin-bottom: 20px;
        overflow: hidden; 
    }
    .ad-banner-bottom {
        margin-top: 20px;
    }

    /* ржЖржХрж░рзНрж╖ржгрзАржпрж╝ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржХрж╛рж░рзНржб */
    .balance-card { 
        background: linear-gradient(135deg, #007bff, #0056b3); 
        color: white; 
        border-radius: 12px; 
        padding: 20px; 
        margin-bottom: 20px; 
        box-shadow: 0 6px 12px rgba(0, 50, 150, 0.2);
    }
    .balance-card h4, .balance-card p {
        margin-bottom: 5px;
    }
    .balance-card .tg-style {
        color: #ffeb3b; 
        font-weight: bold;
    }
    .btn-action { 
        margin: 8px 0; 
        width: 100%; 
        border-radius: 8px; 
        font-size: 1.1rem;
        padding: 12px;
    }
    .text-secondary.small {
        color: #ddd !important; 
    }
    .alert-custom { 
        margin-top: 15px; 
        border-radius: 8px;
    }
    .hidden { display: none; }
    
    /* Loading Spinner */
    .loading-spinner-area {
        text-align: center;
        padding: 50px 0;
        color: #007bff;
    }
    .spinner-border {
        width: 3rem;
        height: 3rem;
        border-width: 0.3em;
    }
    
    /* Admin Button Style */
    #admin-button {
        background-color: #dc3545; 
        color: white;
        border-radius: 8px;
        font-size: 1.1rem;
        padding: 12px;
        margin-top: 15px;
        font-weight: bold;
        animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
      100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }
    /* Admin Table Styling */
    .admin-table-container {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-top: 10px;
    }
    .admin-table-container table {
        margin-bottom: 0;
    }
</style>

<script src='//libtl.com/sdk.js' async></script>

<div class="app-container">
    
    <div class="header">
        <h3 class="tg-style">ЁЯТ░ EarnQuick Official - рж╕рзНржмрж╛ржЧрждржо!</h3>
        <p class="text-danger small">Telegram Mini App</p>
    </div>
    
    <div class="marquee-container">
        <marquee behavior="scroll" direction="left" scrollamount="4">
            <span class="marquee-text">
                ЁЯСЙ рж░рзЗржлрж╛рж░ ржХрж░рзБржи ржПржмржВ ржкрзНрж░рждрж┐ рж░рзЗржлрж╛рж░рзЗ 250 ржкржпрж╝рзЗржирзНржЯ ржмрзЛржирж╛рж╕ ржкрж╛ржи! тЪая╕П ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ ржЪрж▓ржЫрзЗ рж╕ржХрж╛рж▓ рзм:рзжрзж ржЯрж╛ ржерзЗржХрзЗ рж░рж╛ржд рзо:рзжрзж ржЯрж╛ ржкрж░рзНржпржирзНрждред ЁЯФе ржпрзЗржХрзЛржирзЛ ржкрзНрж░рзЯрзЛржЬржирзЗ: ЁЯУЮ 01913621510 | ЁЯУз najmulh219653@gmail.com | ЁЯСд ржЕрзНржпрж╛ржбржорж┐ржи: @najmulhoqueforhad
            </span>
        </marquee>
    </div>
    <div class="ad-banner" id="top-ad-banner" style="height: 90px; line-height: normal;">
        <script type="text/javascript"> 	atOptions = { 		'key' : '00605022df81b880d400151bfc7c2185', 		'format' : 'iframe', 		'height' : 90, 		'width' : 728, 		'params' : {} 	}; </script> <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
    </div>

    <div class="balance-card">
        <p>ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░рзЗрж▓ ржХрж╛ржЙржирзНржЯ: <span id="referral-count" class="tg-style">...</span> ржЬржи</p>
        <p>рж░рзЗржлрж╛рж░рзЗрж▓ ржмрзЛржирж╛рж╕: <span id="referral-bonus" class="tg-style">250</span> ржкрзЯрзЗржирзНржЯ</p>
        <h4 class="mt-2">ржЖржкржирж╛рж░ ржорзЛржЯ ржмрзНржпрж╛рж▓рзЗржирзНрж╕: <span id="current-balance" class="tg-style">...</span></h4>
        <p class="text-secondary small mt-3">ржирзНржпрзВржирждржо ржЙрждрзНрждрзЛрж▓ржи: <span id="min-withdraw">10000</span> ржкржпрж╝рзЗржирзНржЯ = 40 ржЯрж╛ржХрж╛</p>
    </div>

    <div id="loading-spinner" class="loading-spinner-area">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>
    </div>

    <div id="main-content" class="hidden">
        <button id="admin-button" class="btn btn-danger btn-action hidden" onclick="showAdminPanel()">
            ADMIN: рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржо ржбрзЗржЯрж╛ ржжрзЗржЦрзБржи
        </button>

        <button class="btn btn-success btn-action" onclick="showAdTasks()">
            ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи ржПржмржВ 5 ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рзБржи
        </button>
        <button class="btn btn-warning btn-action" data-toggle="modal" data-target="#withdrawModal">
            ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи ржХрж░рзБржи (Withdraw)
        </button>
        
        <hr>

        <p class="small text-center text-muted">ржЕржирзНржпрж╛ржирзНржп ржорзЗржирзБ:</p>
        <button class="btn btn-info btn-sm btn-block" onclick="copyReferralLink()">рж░рзЗржлрж╛рж░ ржХрж░рзБржи (Refer)</button>
        <button class="btn btn-secondary btn-sm btn-block" onclick="alert('ржкрзЗржорзЗржирзНржЯ рж╣рж┐рж╕рзНржЯрзЛрж░рж┐ ржкрзЗржЬ рж╢рзАржШрзНрж░ржЗ ржЖрж╕ржЫрзЗ!')">ржкрзЗржорзЗржирзНржЯ рж╣рж┐рж╕рзНржЯрзЛрж░рж┐</button>
    </div>

    <div id="ad-tasks" class="hidden my-4 p-3 border rounded">
        <h5>ржЖржЬржХрзЗрж░ ржЯрж╛рж╕рзНржХ: ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</h5>
        <p class="small text-muted">ржкрзНрж░рждрж┐ржЯрж┐ ржмрж┐ржЬрзНржЮрж╛ржкржирзЗ **5** ржкржпрж╝рзЗржирзНржЯ! ржЕрзНржпрж╛ржб ржжрзЗржЦрж╛рж░ ржкрж░рзЗржЗ ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ рж╣ржмрзЗред</p>
        
        <button class="btn btn-outline-primary btn-sm btn-block mt-2" onclick="loadAdTask(1, 5);">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рзз (рзл ржкржпрж╝рзЗржирзНржЯ)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="loadAdTask(2, 5);">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рзи (рзл ржкржпрж╝рзЗржирзНржЯ)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="loadAdTask(3, 5);">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рзй (рзл ржкржпрж╝рзЗржирзНржЯ)</button>
        
        <button class="btn btn-danger btn-action mt-3" onclick="hideAdTasks()">ржорзВрж▓ рж╕рзНржХрзНрж░рж┐ржирзЗ ржлрж┐рж░рзЗ ржпрж╛ржи (Cancel)</button>
    </div>

    <div class="ad-banner ad-banner-bottom" id="bottom-ad-banner" style="height: 90px; line-height: normal;">
        <script type="text/javascript"> 	atOptions = { 		'key' : '00605022df81b880d400151bfc7c2185', 		'format' : 'iframe', 		'height' : 90, 		'width' : 728, 		'params' : {} 	}; </script> <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
    </div>

    <div id="admin-panel" class="hidden my-4 p-3 border rounded border-danger">
        <h5 class="text-danger">ЁЯЫС ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓: рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржо ржбрзЗржЯрж╛</h5>
        <div id="admin-data-loader" class="text-center p-3">
             <div class="spinner-border spinner-border-sm text-danger" role="status"></div>
             <p class="small mt-2">ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>
        </div>
        
        <h6 class="mt-3 text-primary">ржкрзЗржирзНржбрж┐ржВ ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ:</h6>
        <div id="pending-withdrawals-data" class="admin-table-container">
            <p class="text-muted small p-2">ржХрзЛржирзЛ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржирзЗржЗред</p>
        </div>

        <h6 class="mt-4 text-primary">рж╢рзАрж░рзНрж╖ рззрзжрзж ржЗржЙржЬрж╛рж░ (ржкржпрж╝рзЗржирзНржЯ ржЕржирзБржпрж╛ржпрж╝рзА):</h6>
        <div id="top-users-data" class="admin-table-container">
            <p class="text-muted small p-2">ржХрзЛржирзЛ ржЗржЙржЬрж╛рж░ ржирзЗржЗред</p>
        </div>

        <button class="btn btn-outline-danger btn-block mt-4" onclick="hideAdminPanel()">ржкрзНржпрж╛ржирзЗрж▓ ржмржирзНржз ржХрж░рзБржи</button>
    </div>

</div>

<div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawModalLabel">ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи (Withdraw)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="withdraw-form">
                    <div class="form-group">
                        <label for="points-to-withdraw">ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржкржпрж╝рзЗржирзНржЯ:</label>
                        <input type="number" class="form-control" id="points-to-withdraw" required min="10000">
                        <small class="form-text text-muted">ржирзНржпрзВржирждржо 10,000 ржкржпрж╝рзЗржирзНржЯ ржЙрждрзНрждрзЛрж▓ржи ржХрж░рж╛ ржпрж╛ржмрзЗред</small>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">ржкрзЗржорзЗржирзНржЯ ржкржжрзНржзрждрж┐:</label>
                        <select class="form-control" id="payment-method" required>
                            <option value="">ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</option>
                            <option value="bkash">ржмрж┐ржХрж╛рж╢ (Bkash)</option>
                            <option value="nagad">ржиржЧржж (Nagad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-number">ржкрзЗржорзЗржирзНржЯ ржиржорзНржмрж░:</label>
                        <input type="text" class="form-control" id="payment-number" required>
                    </div>
                </form>
                <div id="withdraw-message" class="alert mt-3 hidden" role="alert"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ржмрж╛рждрж┐рж▓</button>
                <button type="submit" form="withdraw-form" class="btn btn-success">рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржЬржорж╛ ржжрж┐ржи</button>
            </div>
        </div>
    </div>
</div>

<script>
    const SERVER_URL = 'https://smartearnbdbot.onrender.com';
    const MIN_WITHDRAWAL_POINTS = 10000;
    
    // ЁЯЫС ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржПржЗ ржЖржЗржбрж┐ржЯрж┐ server.js-ржПрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рзЗ ржпрж╛ржпрж╝ 
    const ADMIN_TELEGRAM_ID = '8145444675'; 
    const BLOGGER_TEST_ID = 'blogger_test_user_101'; 

    const WITHDRAWAL_START_HOUR = 6;   
    const WITHDRAWAL_END_HOUR = 20;    

    const MONETAG_ZONES = {
        1: '10085320', 
        2: '10070523', 
        3: '9852420'   
    };

    // --- Global Variables ---
    let currentUserId = null;
    let currentBalance = 0;
    let currentReferralCount = 0;
    let isAdmin = false;

    // --- Utility Functions ---
    function showMessage(type, message, duration = 3000) {
        let messageArea = document.getElementById('global-message-area');
        if (!messageArea) {
            messageArea = document.createElement('div');
            messageArea.id = 'global-message-area';
            document.querySelector('.app-container').prepend(messageArea);
        }
        
        messageArea.className = `alert alert-${type} alert-custom`;
        messageArea.innerText = message;
        messageArea.classList.remove('hidden');
        
        setTimeout(() => {
            messageArea.classList.add('hidden');
        }, duration);
    }

    function updateBalanceDisplay(points, count, userIsAdmin) {
        currentBalance = points;
        currentReferralCount = count;
        isAdmin = userIsAdmin; // рж╕рж╛рж░рзНржнрж╛рж░ ржерзЗржХрзЗ ржкрж╛ржУржпрж╝рж╛ ржЕрзНржпрж╛ржбржорж┐ржи рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣рж▓рзЛ
        
        document.getElementById('current-balance').innerText = points.toLocaleString('bn-BD');
        document.getElementById('referral-count').innerText = count;
        
        // ржЕрзНржпрж╛ржбржорж┐ржи ржмрж╛ржЯржи ржжрзЗржЦрж╛ржУ/рж▓рзБржХрж╛ржирзЛ
        if (isAdmin) {
            document.getElementById('admin-button').classList.remove('hidden');
        } else {
            document.getElementById('admin-button').classList.add('hidden');
        }

        document.getElementById('loading-spinner').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
    }

    function getQueryParams() {
        const params = {};
        window.location.search.substring(1).split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) params[key] = decodeURIComponent(value || '');
        });
        return params;
    }

    // --- Core Logic ---

    async function registerOrCheckUser() {
        const params = getQueryParams();
        let userId = params.uid || BLOGGER_TEST_ID; 
        let refererId = params.ref || null;
        let username = null;
        let firstName = null;

        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
            const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
            userId = tgUser.id.toString();
            username = tgUser.username || null;
            firstName = tgUser.first_name || null;
        } 
        
        currentUserId = userId;

        try {
            const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, refererId, username, firstName })
            });

            const data = await response.json();

            if (data.success) {
                // is_admin рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ рж╕рж╛рж░рзНржнрж╛рж░ ржерзЗржХрзЗ ржЧрзНрж░рж╣ржг ржХрж░рж╛ рж╣рж▓рзЛ
                updateBalanceDisplay(data.earned_points, data.referral_count, data.is_admin);
                showMessage('success', 'тЬЕ рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рж╕ржлрж▓ред ржЗржЙржЬрж╛рж░ ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржпрж╝рзЗржЫрзЗред');
            } else {
                updateBalanceDisplay(0, 0, false);
                showMessage('warning', 'ржЗржЙржЬрж╛рж░ рж▓рзЛржб ржХрж░рждрзЗ ржмрзНржпрж░рзНрже: ' + (data.message || 'ржЕржЬрж╛ржирж╛ рждрзНрж░рзБржЯрж┐ред'));
            }
        } catch (error) {
            console.error('Registration/Check error:', error);
            updateBalanceDisplay(0, 0, false); 
            showMessage('danger', `тЭМ рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ ржмрзНржпрж░рзНржеред ${error.message || 'ржЖржкржирж╛рж░ GitHub/Render ржЪрзЗржХ ржХрж░рзБржиред'}`);
        }
    }
    
    // ЁЯЫС ржирждрзБржи: ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ рж▓рзЛржб ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
    async function loadAdminData() {
        const loader = document.getElementById('admin-data-loader');
        const usersContainer = document.getElementById('top-users-data');
        const withdrawalsContainer = document.getElementById('pending-withdrawals-data');
        
        loader.classList.remove('hidden');
        usersContainer.innerHTML = '';
        withdrawalsContainer.innerHTML = '';

        try {
            const response = await fetch(`${SERVER_URL}/api/admin/data/${currentUserId}`);

            if (response.status === 403) {
                showMessage('danger', 'ЁЯЫС ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗред ржЖржкржирж┐ ржЕрзНржпрж╛ржбржорж┐ржи ржиржиред');
                hideAdminPanel();
                return;
            }

            if (!response.ok) {
                throw new Error('Failed to fetch admin data from server.');
            }

            const data = await response.json();

            if (data.success) {
                renderUsersTable(data.users, usersContainer);
                renderWithdrawalsTable(data.pendingWithdrawals, withdrawalsContainer);
                showMessage('success', 'тЬЕ ржЕрзНржпрж╛ржбржорж┐ржи ржбрзЗржЯрж╛ рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржорзЗ рж▓рзЛржб рж╣ржпрж╝рзЗржЫрзЗред');
            } else {
                showMessage('warning', 'ржбрзЗржЯрж╛ рж▓рзЛржб ржмрзНржпрж░рзНрже: ' + (data.message || 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐ред'));
            }

        } catch (error) {
            console.error('Admin data load error:', error);
            showMessage('danger', `тЭМ ржбрзЗржЯрж╛ рж▓рзЛржбрж┐ржВ рждрзНрж░рзБржЯрж┐: ${error.message}`);
        } finally {
            loader.classList.add('hidden');
        }
    }
    
    function renderUsersTable(users, container) {
        if (users.length === 0) {
            container.innerHTML = '<p class="text-muted small p-2">ржХрзЛржирзЛ ржЗржЙржЬрж╛рж░ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред</p>';
            return;
        }

        let tableHtml = `
            <table class="table table-sm table-striped small">
                <thead>
                    <tr class="bg-primary text-white">
                        <th>#</th>
                        <th>ID / Username</th>
                        <th>Points</th>
                        <th>Ref. Count</th>
                    </tr>
                </thead>
                <tbody>
        `;

        users.forEach((user, index) => {
            const usernameDisplay = user.telegram_username ? `@${user.telegram_username}` : (user.first_name || 'N/A');
            tableHtml += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${usernameDisplay} (ID: ${user.telegram_user_id})</td>
                    <td>${Math.floor(user.earned_points).toLocaleString('bn-BD')}</td>
                    <td>${user.referral_count}</td>
                </tr>
            `;
        });

        tableHtml += `</tbody></table>`;
        container.innerHTML = tableHtml;
    }

    function renderWithdrawalsTable(withdrawals, container) {
        if (withdrawals.length === 0) {
            container.innerHTML = '<p class="text-muted small p-2">ржХрзЛржирзЛ ржкрзЗржирзНржбрж┐ржВ ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржирзЗржЗред</p>';
            return;
        }

        let tableHtml = `
            <table class="table table-sm table-striped small">
                <thead>
                    <tr class="bg-warning text-dark">
                        <th>ID</th>
                        <th>User ID</th>
                        <th>Points</th>
                        <th>Method/Num</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
        `;

        withdrawals.forEach((req) => {
            const time = new Date(req.requested_at).toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit', hour12: true });
            tableHtml += `
                <tr>
                    <td>${req.request_id}</td>
                    <td>${req.telegram_user_id}</td>
                    <td>${Math.floor(req.points_requested).toLocaleString('bn-BD')}</td>
                    <td>${req.payment_method} / ${req.payment_number}</td>
                    <td>${time}</td>
                </tr>
            `;
        });

        tableHtml += `</tbody></table>`;
        container.innerHTML = tableHtml;
    }

    async function addPoints(points) {
        if (!currentUserId || currentUserId === BLOGGER_TEST_ID) {
            showMessage('danger', 'ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рждрзЗ ржмрзНржпрж░рзНржеред ржЖрж╕рж▓ Telegram ID ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/add_points`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, points })
            });
            
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount, isAdmin);
                showMessage('success', `тЬЕ ржЕрзНржпрж╛ржб ржжрзЗржЦрж╛ рж╢рзЗрж╖ред рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рж╕ржлрж▓ред ${points} ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ!`);
            } else {
                showMessage('danger', 'ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рждрзЗ ржмрзНржпрж░рзНрже: ' + (data.message || 'ржЕржЬрж╛ржирж╛ ржХрж╛рж░ржг'));
            }
        } catch (error) {
            console.error('Add points error:', error);
            showMessage('danger', `тЭМ ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рж╛рж░ рж╕ржоржпрж╝ рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рждрзНрж░рзБржЯрж┐: ${error.message}`);
        }
    }
    
    function loadAdTask(adNumber, points) {
        const zoneId = MONETAG_ZONES[adNumber];
        if (!zoneId) return;
        
        showMessage('info', `Monetag/Libtl ржЕрзНржпрж╛ржб рж▓рзЛржб рж╣ржЪрзНржЫрзЗ (Zone: ${zoneId})ред ржЕрзНржпрж╛ржб ржжрзЗржЦрж╛рж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи...`);

        const showFunctionName = `show_${zoneId}`;

        if (window[showFunctionName]) {
            window[showFunctionName]({ ymid: currentUserId })
                .then(() => {
                    console.log(`Ad ${adNumber} finished successfully.`);
                    addPoints(points); 
                })
                .catch((error) => {
                    console.error(`Ad ${adNumber} failed or skipped:`, error);
                    showMessage('warning', `тЪая╕П ржЕрзНржпрж╛ржб рж▓рзЛржб рж╣ржпрж╝ржирж┐ ржмрж╛ ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗред ${points} ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝ржирж┐ред`);
                });
        } else {
            showMessage('danger', `Monetag SDK рж▓рзЛржб рж╣ржпрж╝ржирж┐ред ржкрзЗржЬ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред`);
        }
    }

    document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pointsToWithdraw = parseInt(document.getElementById('points-to-withdraw').value);
        const paymentMethod = document.getElementById('payment-method').value;
        const paymentNumber = document.getElementById('payment-number').value;
        const withdrawMessageArea = document.getElementById('withdraw-message');
        
        withdrawMessageArea.classList.add('hidden');
        
        // ... (ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ рж▓ржЬрж┐ржХ ржЕржкрж░рж┐ржмрж░рзНрждрж┐ржд) ...
        const isWithdrawalTime = () => {
             const now = new Date();
             const hour = now.getHours();
             return hour >= WITHDRAWAL_START_HOUR && hour < WITHDRAWAL_END_HOUR;
        };

        if (!isWithdrawalTime()) {
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = `ржЙрждрзНрждрзЛрж▓ржи рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕ржХрж╛рж▓ ${WITHDRAWAL_START_HOUR}:00 ржЯрж╛ ржерзЗржХрзЗ рж░рж╛ржд ${WITHDRAWAL_END_HOUR}:00 ржЯрж╛ ржкрж░рзНржпржирзНржд ржЪрж▓рзЗред`;
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        if (pointsToWithdraw < MIN_WITHDRAWAL_POINTS || pointsToWithdraw > currentBalance) {
            withdrawMessageArea.className = 'alert alert-warning mt-3';
            withdrawMessageArea.innerText = 'ржЕржкрж░рзНржпрж╛ржкрзНржд ржкржпрж╝рзЗржирзНржЯ ржмрж╛ ржирзНржпрзВржирждржо ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржЪрзЗржпрж╝рзЗ ржХржоред';
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, pointsToWithdraw, paymentMethod, paymentNumber })
            });
            
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount, isAdmin);
                withdrawMessageArea.className = 'alert alert-success mt-3';
                withdrawMessageArea.innerText = 'ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржЕржирзБрж░рзЛржз рж╕ржлрж▓ржнрж╛ржмрзЗ ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ!';
                withdrawMessageArea.classList.remove('hidden');
                
                setTimeout(() => {
                    $('#withdrawModal').modal('hide'); 
                    document.getElementById('withdraw-form').reset();
                }, 2000);

            } else {
                withdrawMessageArea.className = 'alert alert-danger mt-3';
                withdrawMessageArea.innerText = 'ржЙрждрзНрждрзЛрж▓ржи ржмрзНржпрж░рзНрже: ' + data.message;
                withdrawMessageArea.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Withdraw error:', error);
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = 'рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рждрзНрж░рзБржЯрж┐ред';
            withdrawMessageArea.classList.remove('hidden');
        }
    });

    // --- UI/Utility Functions ---
    function showAdTasks() {
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('ad-tasks').classList.remove('hidden');
    }
    
    function hideAdTasks() {
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function showAdminPanel() {
        if (!isAdmin) {
             showMessage('danger', 'ЁЯЫС ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирзЗржЗред ржЖржкржирж┐ ржЕрзНржпрж╛ржбржорж┐ржи ржиржиред');
             return;
        }
        
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        
        // рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржо ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рзБржи
        loadAdminData();
    }

    function hideAdminPanel() {
        document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function copyReferralLink() {
        if (!currentUserId) {
            showMessage('warning', 'ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐ рж▓рзЛржб рж╣ржпрж╝ржирж┐ред');
            return;
        }
        
        const referralLink = `https://t.me/EarnQuick_Official_ржмржд/start?ref=${currentUserId}`;
        
        navigator.clipboard.writeText(referralLink).then(() => {
            showMessage('info', 'рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ! рж▓рж┐ржЩрзНржХ: ' + referralLink);
        }).catch(err => {
            console.error('Copy failed:', err);
            showMessage('warning', 'ржХржкрж┐ ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред рж▓рж┐ржЩрзНржХржЯрж┐ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ ржХржкрж┐ ржХрж░рзБржиред');
        });
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Load JS dependencies
        const script1 = document.createElement('script');
        script1.src = "https://code.jquery.com/jquery-3.5.1.slim.min.js";
        document.head.appendChild(script1);

        const script2 = document.createElement('script');
        script2.src = "https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js";
        document.head.appendChild(script2);

        const script3 = document.createElement('script');
        script3.src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js";
        document.head.appendChild(script3);

        setTimeout(() => {
            registerOrCheckUser();
        }, 300); 
    });

</script>
</div>

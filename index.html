<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarnQuick Official</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src='https://tg-ads.monetag.com/telegram-sdk.js'></script>
    
    <style>
        /* ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶ï‡ßã‡¶° (‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá) */
        :root { 
            --primary-color: #1a73e8; /* Google Blue */
            --secondary-color: #2e7d32; /* Deep Green */
            --background-light: #ffffff; 
            --background-dark: #f3f5f9; /* Light grey background */
            --text-dark: #212121; 
            --text-light: #fefefe; 
        }
        body { 
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif; 
            background-color: var(--background-dark); 
            color: var(--text-dark); 
            margin: 0; padding: 0; 
            touch-action: manipulation; 
            overflow-x: hidden; 
            width: 100%; 
        }
        .container { 
            padding: 0; 
            max-width: 600px; 
            margin: auto; 
            background-color: var(--background-light); 
            min-height: 100vh; 
        }
        .header-container { 
            background: var(--primary-color); 
            color: var(--text-light); 
            padding: 20px 15px 50px 15px; 
            text-align: center; 
            border-radius: 0 0 25px 25px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); 
            position: relative;
        }
        .balance-card {
            background-color: #ffffff;
            color: var(--text-dark);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: absolute; 
            left: 5%;
            right: 5%;
            bottom: -30px; 
            z-index: 10;
            text-align: center;
        }
        .points-display {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--primary-color);
            display: block;
            margin: 5px 0 10px 0;
        }
        .headline-text { font-size: 1.2em; font-weight: bold; margin-bottom: 5px;}
        .referral-info { font-size: 0.8em; opacity: 0.9; }
        .marquee-container { 
            background-color: #fff8e1; 
            color: #ffb300; 
            padding: 8px 10px; 
            margin: 50px 15px 20px 15px; 
            border-radius: 8px; 
            font-size: 0.9em; 
            font-weight: 600; 
            overflow: hidden; 
            border: 1px solid #ffecb3; 
            white-space: nowrap; 
            box-sizing: border-box;
            position: relative;
        }
        .marquee-content {
            display: inline-block;
            padding-left: 100%; 
            animation: marquee 20s linear infinite; 
        }
        @keyframes marquee {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }
        #ad-button, #withdraw-button { 
            border: none; 
            padding: 15px 20px; 
            font-size: 18px; 
            font-weight: bold; 
            border-radius: 10px; 
            cursor: pointer; 
            width: 90%; 
            margin: 10px 5%; 
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        }
        #ad-button { 
            background-color: var(--secondary-color); 
            color: var(--text-light);
        }
        #withdraw-button { 
            background-color: #FF5722; 
            color: var(--text-light);
        }
        #withdraw-button.disabled-time { 
            background-color: #ccc; 
            cursor: not-allowed;
            color: #666; 
        } 
        .menu-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            padding: 10px 5%;
            margin-top: 10px;
        }
        .menu-btn-container {
            width: 45%;
            margin-bottom: 15px;
            text-align: center;
        }
        .menu-btn {
            background-color: var(--background-light);
            color: var(--primary-color);
            border: 1px solid #e0e0e0;
            padding: 12px 5px;
            font-size: 15px;
            border-radius: 10px;
            width: 100%;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.2s;
        }
        .menu-icon {
            margin-right: 8px;
            font-size: 1.3em;
        }
        .ad-container {
             text-align: center; 
             margin: 15px 0;
             border: 1px solid #eee; 
             padding: 5px;
             background-color: #fff;
             max-width: 100%; 
             overflow: hidden;
        }
        .ad-banner-slot {
            display: flex;
            justify-content: center;
            min-height: 50px; 
        }
        .admin-view { padding: 15px; }
        .admin-stats-summary { display: flex; flex-wrap: wrap; justify-content: space-between; margin-bottom: 20px; }
        .stat-card { background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 10px; width: 48%; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-card h4 { margin-top: 0; color: #1565c0; font-size: 0.9em; }
        .stat-card p { font-size: 1.5em; font-weight: bold; color: #0d47a1; margin: 0; }
        .stat-card.full-width { width: 100%; background-color: #ffe0b2; }
        .withdrawal-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; background-color: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .action-buttons button { margin-right: 10px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; }
        .complete-btn { background-color: #4CAF50; }
        .cancel-btn { background-color: #F44336; }
    </style>
</head>
<body>
    
    <div class="user-view">
        <div class="header-container">
            <div class="headline-text">üí∞ EarnQuick Official - ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! üí∞</div>
            <div class="referral-info">
                ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü: <span id="referral-count-display">0</span> ‡¶ú‡¶® | 
                ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: 250 ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü
            </div>
            
            <div class="balance-card">
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                <span class="points-display" id="total-points">0</span>
                <p style="font-size: 0.8em; color: #757575;">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: 10000 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü = 40 ‡¶ü‡¶æ‡¶ï‡¶æ</p>
            </div>
        </div>
        
        <div class="marquee-container">
            <div class="marquee-content">
                ‚ú® **‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ò‡ßã‡¶∑‡¶£‡¶æ:** ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: **‡¶∏‡¶ï‡¶æ‡¶≤ ‡ß¨:‡ß¶‡ß¶‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ‡ßÆ:‡ß¶‡ß¶‡¶ü‡¶æ** ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§‡•§ | ü§ù ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ **250 ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü** ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ú‡¶ø‡¶§‡ßá ‡¶®‡¶ø‡¶®! | üìû **‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó**: 01913621510 | üèÜ ‡¶Ü‡¶∞‡ßã ‡¶∏‡¶π‡¶ú ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®‡•§
            </div>
        </div>
        
        <div class="ad-container">
            <div id="banner-ad-slot-1" class="ad-banner-slot">
                </div>
        </div>
        
        <button id="ad-button" onclick="handleMonetagAdClick()">‚≠ê ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç 5 ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Monetag)</button>
        
        <button id="withdraw-button" onclick="openWithdrawal()">üí∏ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)</button>
        <p id="status-message" style="text-align: center; font-size: 0.9em; margin: 10px 0;">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>

        <div class="menu-grid">
            <div class="menu-btn-container" onclick="openReferral()"><span class="menu-icon">üîó</span><button class="menu-btn">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
            <div class="menu-btn-container" onclick="openHistory()"><span class="menu-icon">üßæ</span><button class="menu-btn">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</button></div>
            <div class="menu-btn-container"><span class="menu-icon">üìû</span><button class="menu-btn" onclick="openSupport()">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button></div>
            
            <div class="menu-btn-container" id="admin-access-btn-container" style="display:none;" onclick="toggleAdminView(true)">
                <span class="menu-icon" style="color:#f44336;">üëë</span>
                <button class="menu-btn" style="background-color: #f44336; color: white;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</button>
            </div>
        </div>
        
        <div class="ad-container">
             <div id="banner-ad-slot-2" class="ad-banner-slot">
                 </div>
        </div>
    </div>
    
    <div class="admin-view" id="admin-main-view" style="display:none;">
        <h2 style="text-align: center; color: #1d2b64; padding-top: 10px;">üèÜ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
        <p style="text-align: center; font-weight: bold; color: #f44336; margin-bottom: 20px;">‚ö†Ô∏è ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶Ü‡¶õ‡ßá‡¶®‡•§</p>
        
        <div class="admin-stats-summary">
            <div class="stat-card">
                <h4>‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h4>
                <p id="stat-total-users">...</p>
            </div>
            <div class="stat-card">
                <h4>‡¶Æ‡ßã‡¶ü ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü (‡¶∏‡¶ï‡¶≤)</h4>
                <p id="stat-total-points">...</p>
            </div>
            <div class="stat-card full-width pending">
                <h4>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</h4>
                <p id="stat-pending-withdrawals">...</p>
            </div>
        </div>
        
        <button id="refresh-withdrawals" onclick="loadWithdrawals('Pending')" style="background-color: #2196F3; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 15px; font-weight: bold;">üîÑ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        
        <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
            <button onclick="loadWithdrawals('Pending')" style="padding: 8px; background-color: #FFC107; border: none; border-radius: 5px; font-weight: bold;">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</button>
            <button onclick="loadWithdrawals('Completed')" style="padding: 8px; background-color: #4CAF50; border: none; border-radius: 5px; font-weight: bold;">‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü‡ßá‡¶°</button>
            <button onclick="loadWithdrawals('Cancelled')" style="padding: 8px; background-color: #F44336; border: none; border-radius: 5px; font-weight: bold;">‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶∏‡ßá‡¶≤‡¶°</button>
        </div>
        
        <h3 id="withdrawal-list-title" style="color: #607D8B;">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
        <div id="withdrawal-list-container">
            <p style="text-align: center;" id="admin-status-message">‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
        </div>
        
        <button onclick="toggleAdminView(false)" style="background-color: #795548; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 20px; font-weight: bold;">üë§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶â‡¶§‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
    </div>
    
</body>

<script>
    // ‚òÖ‚òÖ‚òÖ ‡ßß. ‡¶ï‡¶®‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶∏ (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶æ‡¶®) ‚òÖ‚òÖ‚òÖ
    const SERVER_URL = 'https://smartearnbdbot.onrender.com';
    const BOT_USERNAME = '@EarnQuick_Official_bot'; 
    const ADMIN_ID = '8145444675'; 
    const CONTACT_NUMBER = '01913621510'; 
    const CONTACT_EMAIL = 'najmulh219653@gmail.com'; 
    
    // Monetag Rewarded Interstitial Ad Zone ID (Monetag ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
    const MONETAG_AD_UNIT_ID = '10070523'; 

    const POINTS_PER_TAKA = 250; 
    const POINTS_PER_AD = 5; 
    const MIN_WITHDRAW_POINTS = 10000;
    const WITHDRAW_START_HOUR = 6;  
    const WITHDRAW_END_HOUR = 20; 

    let telegramUserId = null;
    let currentPoints = 0;
    let adRewardReceived = false; 

    // ‚òÖ‚òÖ‚òÖ ‡ß®. Adsterra ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡ßã‡¶° (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶ï‡ßã‡¶°) ‚òÖ‚òÖ‚òÖ
    function loadBannerAds() {
         const adCode = `
            <script type="text/javascript"> 	
                atOptions = { 		
                    'key' : '00605022df81b880d400151bfc7c2185', 		
                    'format' : 'iframe', 		
                    'height' : 90, 		
                    'width' : 728, 		
                    'params' : {} 	
                }; 
            </script> 
            <script type="text/javascript" src="//enabledetective.com/00605022df81b880d400151bfc7c2185/invoke.js"></script>
        `;
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∏‡ßç‡¶≤‡¶ü ‡ßß ‡¶è‡¶¨‡¶Ç ‡ß® ‡¶§‡ßá ‡¶ï‡ßã‡¶° ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        document.getElementById('banner-ad-slot-1').innerHTML = adCode;
        document.getElementById('banner-ad-slot-2').innerHTML = adCode;
    }

    // ‚òÖ‚òÖ‚òÖ ‡ß©. Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‚òÖ‚òÖ‚òÖ
    
    // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
    function onAdRewardSuccess() {
        const adBtn = document.getElementById('ad-button');
        adBtn.innerText = '‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

        addPointsToUser(POINTS_PER_AD).then(success => {
            if (success) {
                adBtn.innerText = `‚≠ê ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ${POINTS_PER_AD} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Monetag)`;
            } else {
                 adBtn.innerText = `‚ùå ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®`;
            }
            adBtn.disabled = false; 
        });
    }
    
    // Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
    function handleMonetagAdClick() {
        const adBtn = document.getElementById('ad-button');
        adBtn.disabled = true;
        adBtn.innerText = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ...';
        
        adRewardReceived = false; 

        // Monetag SDK ‡¶ö‡ßá‡¶ï
        if (typeof TelegramSDK === 'undefined' || typeof TelegramSDK.showAd === 'undefined' || !MONETAG_AD_UNIT_ID) {
            Telegram.WebApp.showAlert('Monetag SDK ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
             setTimeout(() => {
                adBtn.innerText = `‚≠ê ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ${POINTS_PER_AD} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Monetag)`;
                adBtn.disabled = false;
            }, 5000); 
            return;
        }

        // Monetag ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ
        TelegramSDK.showAd(MONETAG_AD_UNIT_ID, {
            onSuccess: function() {
                adRewardReceived = true;
                onAdRewardSuccess(); 
            },
            onError: function(error) {
                Telegram.WebApp.showAlert(`‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'}. ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶´‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§`);
                 setTimeout(() => {
                    // ‡¶Ø‡¶¶‡¶ø ‡¶´‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®
                    // onAdRewardSuccess(); 
                    adBtn.innerText = `‚≠ê ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ${POINTS_PER_AD} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Monetag)`;
                    adBtn.disabled = false;
                }, 5000); 
            },
            onClose: function() {
                if (!adRewardReceived) {
                    adBtn.innerText = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶π‡ßü‡¶®‡¶ø ‡¶¨‡¶æ ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
                    adBtn.disabled = false;
                }
            }
        });
    }

    // ‚òÖ‚òÖ‚òÖ ‡ß™. ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (API ‡¶ï‡¶≤, UI, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®) ‚òÖ‚òÖ‚òÖ
    // (‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶Ü‡¶õ‡ßá, ‡¶Ø‡¶æ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó, ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá)

    function loadTelegramUser() {
        try {
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user && user.id) {
                telegramUserId = user.id.toString();
                return true;
            }
            document.getElementById('status-message').innerText = "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§";
            return false;
        } catch (e) {
            document.getElementById('status-message').innerText = "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ SDK ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§";
            return false;
        }
    }
    
    function toggleAdminView(isAdmin) {
        if (isAdmin) {
            document.querySelector('.user-view').style.display = 'none';
            document.getElementById('admin-main-view').style.display = 'block';
            loadAdminStats(); 
            document.getElementById('withdrawal-list-container').innerHTML = '';
            document.getElementById('admin-status-message').innerText = "‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®...";
        } else {
            document.querySelector('.user-view').style.display = 'block';
            document.getElementById('admin-main-view').style.display = 'none';
            if (telegramUserId) fetchUserData(true); 
        }
    }
    
    async function loadAdminStats() {
         try {
            const response = await fetch(`${SERVER_URL}/api/admin/stats`);
            if (response.ok) {
                const data = await response.json();
                document.getElementById('stat-total-users').innerText = data.total_users.toLocaleString();
                document.getElementById('stat-total-points').innerText = data.total_points.toLocaleString();
                document.getElementById('stat-pending-withdrawals').innerText = data.pending_withdrawals.toLocaleString();
            }
        } catch (error) {
            console.error('Admin Stats Fetch Error:', error);
            Telegram.WebApp.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§");
        }
    }

    async function loadWithdrawals(status) {
        document.getElementById('admin-status-message').innerText = ` ${status} ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
        document.getElementById('withdrawal-list-title').innerText = `${status} ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ`;
        
        try {
            const response = await fetch(`${SERVER_URL}/api/admin/withdrawals?status=${status}`);
            if (response.ok) {
                const withdrawals = await response.json();
                const container = document.getElementById('withdrawal-list-container');
                container.innerHTML = '';
                
                if (withdrawals.length === 0) {
                    container.innerHTML = `<p style="text-align: center;">‡¶ï‡ßã‡¶®‡ßã ${status} ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</p>`;
                    return;
                }

                withdrawals.forEach(req => {
                    const takaAmount = (req.points / POINTS_PER_TAKA).toFixed(2);
                    const card = document.createElement('div');
                    card.className = 'withdrawal-card';
                    card.innerHTML = `
                        <p><strong>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID:</strong> ${req.user_id}</p>
                        <p><strong>‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü:</strong> ${req.points.toLocaleString()} (${takaAmount} ‡¶ü‡¶æ‡¶ï‡¶æ)</p>
                        <p><strong>‡¶Æ‡ßá‡¶•‡¶°:</strong> ${req.method} (${req.account})</p>
                        <p><strong>‡¶∏‡¶Æ‡¶Ø‡¶º:</strong> ${new Date(req.created_at).toLocaleString()}</p>
                        ${status === 'Pending' ? 
                            `<div class="action-buttons">
                                <button class="complete-btn" onclick="updateWithdrawalStatus('${req._id}', 'Completed', '${req.user_id}')">‚úÖ Complete</button>
                                <button class="cancel-btn" onclick="updateWithdrawalStatus('${req._id}', 'Cancelled', '${req.user_id}')">‚ùå Cancel</button>
                            </div>` : ''}
                    `;
                    container.appendChild(card);
                });
                 document.getElementById('admin-status-message').innerText = "";
            } else {
                document.getElementById('admin-status-message').innerText = "‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§";
            }
        } catch (error) {
            console.error('Withdrawals Fetch Error:', error);
            document.getElementById('admin-status-message').innerText = "‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§";
        }
    }

    async function updateWithdrawalStatus(requestId, newStatus, userId) {
        if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ${newStatus} ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?`)) return;

        try {
            const response = await fetch(`${SERVER_URL}/api/admin/update_withdrawal`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ requestId, status: newStatus, adminId: telegramUserId, userId })
            });

            if (response.ok) {
                Telegram.WebApp.showAlert(`‚úÖ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ${newStatus} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
                loadWithdrawals('Pending'); // Refresh the pending list
                loadAdminStats(); // Refresh stats
            } else {
                const errorData = await response.json();
                Telegram.WebApp.showAlert(`‚ùå ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${errorData.error || response.statusText}`);
            }
        } catch (error) {
            Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§");
        }
    }

    async function fetchUserData(isRefresh = false) {
         if(!isRefresh) document.getElementById('status-message').innerText = "‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
         
         const urlParams = new URLSearchParams(window.location.search);
         const refererId = urlParams.get('start'); 
         
         try {
             const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify({ 
                     userId: telegramUserId,
                     refererId: refererId 
                 })
             });
             
             if (response.ok) {
                 const data = await response.json();
                 currentPoints = data.earned_points;
                 document.getElementById('total-points').innerText = currentPoints.toLocaleString();
                 document.getElementById('referral-count-display').innerText = data.referral_count.toLocaleString();
                 
                 if (data.message && data.message.includes('Referral bonus')) {
                    Telegram.WebApp.showAlert(`‚úÖ ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤! ${data.message.split('points added')[0].split('Referral bonus of ')[1]} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞‡¶ï‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
                 }

                 updateUI();
                 document.getElementById('status-message').innerText = "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶ö‡¶≤ ‡¶Ü‡¶õ‡ßá‡¶®‡•§";
                 document.getElementById('ad-button').disabled = false;
                 
                 const adminBtnContainer = document.getElementById('admin-access-btn-container');
                 if (telegramUserId.toString() === ADMIN_ID) {
                     adminBtnContainer.style.display = 'flex'; 
                     document.getElementById('status-message').innerText += " (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§)";
                 } else {
                     adminBtnContainer.style.display = 'none'; 
                 }
                 
             } else {
                 document.getElementById('status-message').innerText = `‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§`;
                 Telegram.WebApp.showAlert(`‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}. ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§`);
             }
         } catch (error) {
             console.error('Fetch Error:', error);
             document.getElementById('status-message').innerText = "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡ß´-‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"; 
             Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡ß´-‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§");
         }
    }

    function updateUI() {
        const now = new Date();
        const hour = now.getHours();
        const withdrawButton = document.getElementById('withdraw-button');
        const isDisabled = hour < WITHDRAW_START_HOUR || hour >= WITHDRAW_END_HOUR;

        if (isDisabled) {
            withdrawButton.disabled = true;
            withdrawButton.classList.add('disabled-time');
            withdrawButton.innerText = `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡¶®‡ßç‡¶ß (‡¶∏‡¶ï‡¶æ‡¶≤ ${WITHDRAW_START_HOUR}‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶æ‡¶§ ${WITHDRAW_END_HOUR}‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ)`;
        } else {
             withdrawButton.disabled = false;
             withdrawButton.classList.remove('disabled-time');
             withdrawButton.innerText = `üí∏ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Withdraw)`;
        }
    }
    
    async function addPointsToUser(points) {
        try {
            const response = await fetch(`${SERVER_URL}/api/add_points`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: telegramUserId, points: points })
            });

            if (response.ok) {
                const data = await response.json();
                currentPoints = data.new_points;
                document.getElementById('total-points').innerText = currentPoints.toLocaleString();
                // Telegram.WebApp.showAlert(`üéâ ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ${points} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`); // Alert removed for better UX
                return true;
            } else {
                Telegram.WebApp.showAlert(`‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ${response.status}`);
                return false;
            }
        } catch (error) {
            Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§");
            return false;
        }
    }
    
    function openWithdrawal() {
        if (currentPoints < MIN_WITHDRAW_POINTS) {
            Telegram.WebApp.showAlert(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${MIN_WITHDRAW_POINTS} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡•§`);
            return;
        }

        Telegram.WebApp.showPopup({
            title: 'üí∏ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®',
            message: `‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ${(currentPoints / POINTS_PER_TAKA).toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§`,
            buttons: [
                { id: 'nagad', type: 'default', text: '‡¶®‡¶ó‡¶¶ (Nagad)' },
                { id: 'bkash', type: 'default', text: '‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ (bKash)' },
                { id: 'rocket', type: 'default', text: '‡¶∞‡¶ï‡ßá‡¶ü (Rocket)' },
                { id: 'cancel', type: 'cancel', text: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®' }
            ]
        }, (buttonId) => {
            if (buttonId !== 'cancel' && buttonId !== null) {
                Telegram.WebApp.showPopup({
                    title: `‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ${buttonId.toUpperCase()}`,
                    message: `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ${buttonId.toUpperCase()} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${MIN_WITHDRAW_POINTS} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü):`,
                    buttons: [
                         { id: 'submit', type: 'default', text: '‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®' },
                         { id: 'back', type: 'cancel', text: '‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶Ø‡¶æ‡¶®' }
                    ]
                }, (submitId) => {
                     if (submitId === 'submit') {
                        const paymentMethod = buttonId.toUpperCase();
                        const numInput = prompt(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ${paymentMethod} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:`);
                        if (!numInput) return;
                        const pointsInput = prompt(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${MIN_WITHDRAW_POINTS} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü):`);
                        if (!pointsInput) return;

                        const requestedPoints = parseInt(pointsInput);

                        if (isNaN(requestedPoints) || requestedPoints < MIN_WITHDRAW_POINTS || requestedPoints > currentPoints) {
                            Telegram.WebApp.showAlert(`‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶≠‡ßÅ‡¶≤‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ${MIN_WITHDRAW_POINTS} ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§`);
                            return;
                        }
                        
                        submitWithdrawalRequest(paymentMethod, numInput, requestedPoints);
                     }
                });
            }
        });
    }
    
    async function submitWithdrawalRequest(method, account, points) {
        try {
            const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: telegramUserId, method, account, points })
            });

            if (response.ok) {
                Telegram.WebApp.showAlert('‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§');
                fetchUserData(true);
            } else {
                const errorData = await response.json();
                Telegram.WebApp.showAlert(`‚ùå ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${errorData.error || response.statusText}`);
            }
        } catch (error) {
            Telegram.WebApp.showAlert("‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§");
        }
    }


    function openReferral() {
        const referralLink = `https://t.me/${BOT_USERNAME.replace('@', '')}?start=${telegramUserId}`;
        
        Telegram.WebApp.showPopup({
            title: 'ü§ù ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï',
            message: `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶è‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® 250 ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü!`,
            buttons: [
                { id: 'copy', type: 'default', text: '‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®' },
                { id: 'share', type: 'default', text: '‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®' },
                { id: 'close', type: 'cancel', text: '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®' }
            ]
        }, (buttonId) => {
             if (buttonId === 'copy') {
                navigator.clipboard.writeText(referralLink).then(() => {
                    Telegram.WebApp.showAlert("‚úÖ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                });
             } else if (buttonId === 'share') {
                Telegram.WebApp.shareUrl(referralLink, "‡¶è‡¶á ‡¶¨‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶π‡¶ú‡ßá‡¶á ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü! ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!");
             }
        });
    }

    function openHistory() {
         Telegram.WebApp.showAlert('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá ‡¶Ü‡¶õ‡ßá‡•§');
    }

    function openSupport() { 
         Telegram.WebApp.showAlert(`üìû ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:\n\n‡¶´‡ßã‡¶®: ${CONTACT_NUMBER}\n‡¶á‡¶Æ‡ßá‡¶á‡¶≤: ${CONTACT_EMAIL}`); 
    }


    // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ---
    document.addEventListener('DOMContentLoaded', () => {
        loadBannerAds(); 

        if (loadTelegramUser()) {
            fetchUserData(); 
        }

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    });
</script>
    </html>

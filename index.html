<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnQuick Official</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* ржЙржирзНржиржд CSS ржпрж╛ ржЖржкржирж╛рж░ ржорж┐ржирж┐ ржЕрзНржпрж╛ржкржЯрж┐ржХрзЗ ржЖрж░ржУ ржЖржХрж░рзНрж╖ржгрзАржпрж╝ ржХрж░рзЗ рждрзБрж▓ржмрзЗ */
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: #f8f9fa; 
            padding: 0; 
            margin: 0; 
            min-height: 100vh;
        }
        .app-container { 
            width: 100%; 
            min-height: 100vh;
            margin: 0 auto; 
            background-color: #ffffff; 
            padding: 20px; 
            box-shadow: none; 
            box-sizing: border-box; 
        }
        .header { 
            text-align: center; 
            margin-bottom: 5px; 
            padding-top: 10px;
        }
        .tg-style { color: #007bff; font-weight: bold; } 

        /* ржЪрж▓ржорж╛ржи рж╣рзЗржбрж▓рж╛ржЗржи (Marquee) рж╕рзНржЯрж╛ржЗрж▓ */
        .marquee-container {
            background-color: #ffeb3b; 
            border: 1px solid #ffb300;
            border-radius: 6px;
            padding: 5px 10px;
            color: #333;
            font-weight: bold;
            overflow: hidden; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 15px !important;
        }
        .marquee-text {
            font-size: 0.9rem;
            white-space: nowrap; 
        }

        /* ржЕрзНржпрж╛ржб ржмрзНржпрж╛ржирж╛рж░ рж╕рзНржЯрж╛ржЗрж▓ (ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░) */
        .ad-banner {
            width: 100%;
            height: 50px;
            background-color: #e0e0e0;
            border: 1px dashed #999;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }
        .ad-banner-bottom {
            margin-top: 20px;
        }


        /* ржЖржХрж░рзНрж╖ржгрзАржпрж╝ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржХрж╛рж░рзНржб */
        .balance-card { 
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 6px 12px rgba(0, 50, 150, 0.2);
        }
        .balance-card h4, .balance-card p {
            margin-bottom: 5px;
        }
        .balance-card .tg-style {
            color: #ffeb3b; 
            font-weight: bold;
        }
        .btn-action { 
            margin: 8px 0; 
            width: 100%; 
            border-radius: 8px; 
            font-size: 1.1rem;
            padding: 12px;
        }
        .text-secondary.small {
            color: #ddd !important; 
        }
        .alert-custom { 
            margin-top: 15px; 
            border-radius: 8px;
        }
        .hidden { display: none; }
        
        /* Loading Spinner */
        .loading-spinner-area {
            text-align: center;
            padding: 50px 0;
            color: #007bff;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        /* Admin Button Style */
        #admin-button {
            background-color: #dc3545; 
            color: white;
            border-radius: 8px;
            font-size: 1.1rem;
            padding: 12px;
            margin-top: 15px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
          0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
          70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
          100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <div class="header">
        <h3 class="tg-style">ЁЯТ░ EarnQuick Official - рж╕рзНржмрж╛ржЧрждржо!</h3>
        <p class="text-danger small">Telegram Mini App</p>
    </div>
    
    <div class="marquee-container">
        <marquee behavior="scroll" direction="left" scrollamount="4">
            <span class="marquee-text">
                тЪая╕П ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ ржЪрж▓ржЫрзЗ рж╕ржХрж╛рж▓ рзм:рзжрзж ржЯрж╛ ржерзЗржХрзЗ рж░рж╛ржд рзо:рзжрзж ржЯрж╛ ржкрж░рзНржпржирзНрждред ЁЯФе ржпрзЗржХрзЛржирзЛ ржкрзНрж░рзЯрзЛржЬржирзЗ: ЁЯУЮ 01913621510 | ЁЯУз najmulh219653@gmail.com | ЁЯСд ржЕрзНржпрж╛ржбржорж┐ржи: @najmulhoqueforhad
            </span>
        </marquee>
    </div>
    <div class="ad-banner" id="top-ad-banner">
        ржПржб ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ рзз (Adsterra/Ads)
    </div>

    <div class="balance-card">
        <p>ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░рзЗрж▓ ржХрж╛ржЙржирзНржЯ: <span id="referral-count" class="tg-style">...</span> ржЬржи</p>
        <p>рж░рзЗржлрж╛рж░рзЗрж▓ ржмрзЛржирж╛рж╕: <span id="referral-bonus" class="tg-style">250</span> ржкрзЯрзЗржирзНржЯ</p>
        <h4 class="mt-2">ржЖржкржирж╛рж░ ржорзЛржЯ ржмрзНржпрж╛рж▓рзЗржирзНрж╕: <span id="current-balance" class="tg-style">...</span></h4>
        <p class="text-secondary small mt-3">ржирзНржпрзВржирждржо ржЙрждрзНрждрзЛрж▓ржи: <span id="min-withdraw">10000</span> ржкржпрж╝рзЗржирзНржЯ = 40 ржЯрж╛ржХрж╛</p>
    </div>

    <div id="loading-spinner" class="loading-spinner-area">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>
    </div>

    <div id="main-content" class="hidden">
        <button id="admin-button" class="btn btn-danger btn-action hidden" onclick="showAdminPanel()">
            ADMIN: ржЗржЙржЬрж╛рж░ ржЗржиржлрзЛ ржУ ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ ржжрзЗржЦрзБржи
        </button>

        <button class="btn btn-success btn-action" onclick="showAdTasks()">
            ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи ржПржмржВ 5 ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рзБржи
        </button>
        <button class="btn btn-warning btn-action" data-toggle="modal" data-target="#withdrawModal">
            ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи ржХрж░рзБржи (Withdraw)
        </button>
        
        <hr>

        <p class="small text-center text-muted">ржЕржирзНржпрж╛ржирзНржп ржорзЗржирзБ:</p>
        <button class="btn btn-info btn-sm btn-block" onclick="copyReferralLink()">рж░рзЗржлрж╛рж░ ржХрж░рзБржи (Refer)</button>
        <button class="btn btn-secondary btn-sm btn-block" onclick="alert('ржкрзЗржорзЗржирзНржЯ рж╣рж┐рж╕рзНржЯрзЛрж░рж┐ ржкрзЗржЬ рж╢рзАржШрзНрж░ржЗ ржЖрж╕ржЫрзЗ!')">ржкрзЗржорзЗржирзНржЯ рж╣рж┐рж╕рзНржЯрзЛрж░рж┐</button>
    </div>

    <div id="ad-tasks" class="hidden my-4 p-3 border rounded">
        <h5>ржЖржЬржХрзЗрж░ ржЯрж╛рж╕рзНржХ: ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</h5>
        <p class="small text-muted">ржкрзНрж░рждрж┐ржЯрж┐ ржмрж┐ржЬрзНржЮрж╛ржкржирзЗ **5** ржкржпрж╝рзЗржирзНржЯ!</p>
        
        <button class="btn btn-outline-primary btn-sm btn-block mt-2" onclick="addPoints(5)">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рзз (рзл ржкржпрж╝рзЗржирзНржЯ)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="addPoints(5)">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рзи (рзл ржкржпрж╝рзЗржирзНржЯ)</button>
        <button class="btn btn-outline-primary btn-sm btn-block" onclick="addPoints(5)">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рзй (рзл ржкржпрж╝рзЗржирзНржЯ)</button>
        
        <button class="btn btn-danger btn-action mt-3" onclick="hideAdTasks()">ржорзВрж▓ рж╕рзНржХрзНрж░рж┐ржирзЗ ржлрж┐рж░рзЗ ржпрж╛ржи (Cancel)</button>
    </div>

    <div class="ad-banner ad-banner-bottom" id="bottom-ad-banner">
        ржПржб ржкрзНрж▓рзЗрж╕рж╣рзЛрж▓рзНржбрж╛рж░ рзи (Adsterra/Ads)
    </div>

    <div id="admin-panel" class="hidden my-4 p-3 border rounded border-danger">
        <h5 class="text-danger">ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓</h5>
        <p>ржПржЦрж╛ржирзЗ ржбрзЗржЯрж╛ рж▓рзЛржб рж╣ржмрзЗ (ржЗржЙржЬрж╛рж░ ржЗржиржлрзЛ ржУ ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓)ред</p>
        <button class="btn btn-outline-danger btn-block" onclick="hideAdminPanel()">ржкрзНржпрж╛ржирзЗрж▓ ржмржирзНржз ржХрж░рзБржи</button>
    </div>

</div>

<div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="withdrawModalLabel">ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи (Withdraw)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="withdraw-form">
                    <div class="form-group">
                        <label for="points-to-withdraw">ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржкржпрж╝рзЗржирзНржЯ:</label>
                        <input type="number" class="form-control" id="points-to-withdraw" required min="10000">
                        <small class="form-text text-muted">ржирзНржпрзВржирждржо 10,000 ржкржпрж╝рзЗржирзНржЯ ржЙрждрзНрждрзЛрж▓ржи ржХрж░рж╛ ржпрж╛ржмрзЗред</small>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">ржкрзЗржорзЗржирзНржЯ ржкржжрзНржзрждрж┐:</label>
                        <select class="form-control" id="payment-method" required>
                            <option value="">ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</option>
                            <option value="bkash">ржмрж┐ржХрж╛рж╢ (Bkash)</option>
                            <option value="nagad">ржиржЧржж (Nagad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-number">ржкрзЗржорзЗржирзНржЯ ржиржорзНржмрж░:</label>
                        <input type="text" class="form-control" id="payment-number" required>
                    </div>
                </form>
                <div id="withdraw-message" class="alert mt-3 hidden" role="alert"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">ржмрж╛рждрж┐рж▓</button>
                <button type="submit" form="withdraw-form" class="btn btn-success">рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржЬржорж╛ ржжрж┐ржи</button>
            </div>
        </div>
    </div>
</div>

<script>
    // тЪая╕П ржЖржкржирж╛рж░ Render рж╕рж╛рж░рзНржнрж╛рж░ URL ржПржЦрж╛ржирзЗ ржмрж╕рж╛ржи тЪая╕П
    const SERVER_URL = 'https://smartearnbdbot.onrender.com';
    const REFERRAL_POINTS = 250;
    const MIN_WITHDRAWAL_POINTS = 10000;
    
    // ЁЯЫС ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг: ржЖржкржирж╛рж░ ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐ ржПржЦрж╛ржирзЗ ржмрж╕рж╛ржи
    const ADMIN_TELEGRAM_ID = '8145444675'; // Najmul Hoque Forhad ржПрж░ ID
    
    // ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ рж╕ржоржпрж╝рж╕рзАржорж╛ (рзирзк ржШржирзНржЯрж╛ ржлрж░ржорзНржпрж╛ржЯ)
    const WITHDRAWAL_START_HOUR = 6;   // рж╕ржХрж╛рж▓ рзмржЯрж╛
    const WITHDRAWAL_END_HOUR = 20;    // рж░рж╛ржд рзоржЯрж╛

    // --- Global Variables ---
    let currentUserId = null;
    let currentBalance = 0;
    let currentReferralCount = 0;
    let isAdmin = false;

    // --- Utility Functions ---
    function showMessage(type, message, duration = 3000) {
        const messageArea = document.getElementById('message-area');
        messageArea.className = `alert alert-${type} alert-custom`;
        messageArea.innerText = message;
        messageArea.classList.remove('hidden');
        setTimeout(() => {
            messageArea.classList.add('hidden');
        }, duration);
    }
    
    function isWithdrawalTime() {
        const now = new Date();
        const hour = now.getHours();
        return hour >= WITHDRAWAL_START_HOUR && hour < WITHDRAWAL_END_HOUR;
    }

    function updateBalanceDisplay(points, count) {
        currentBalance = points;
        currentReferralCount = count;
        document.getElementById('current-balance').innerText = points.toLocaleString('bn-BD');
        document.getElementById('referral-count').innerText = count;
        
        // ржЕрзНржпрж╛ржбржорж┐ржи ржмрж╛ржЯржи ржжрзЗржЦрж╛ржУ/рж▓рзБржХрж╛ржирзЛ
        if (isAdmin) {
            document.getElementById('admin-button').classList.remove('hidden');
        } else {
            document.getElementById('admin-button').classList.add('hidden');
        }

        document.getElementById('loading-spinner').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
    }

    function getQueryParams() {
        const params = {};
        window.location.search.substring(1).split('&').forEach(pair => {
            const [key, value] = pair.split('=');
            if (key) params[key] = decodeURIComponent(value || '');
        });
        return params;
    }

    // --- Core Logic ---

    // 1. Register or Check User 
    async function registerOrCheckUser() {
        const params = getQueryParams();
        let userId = params.uid || 'blogger_test_user_101'; 
        let refererId = params.ref || null;
        
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
            userId = window.Telegram.WebApp.initDataUnsafe.user.id.toString();
        } 
        // ЁЯЫС ржЕрзНржпрж╛ржбржорж┐ржи ржЖржЗржбрж┐ ржЪрзЗржХ
        if (userId === ADMIN_TELEGRAM_ID) {
            isAdmin = true;
        }

        currentUserId = userId;
        
        // ржпржжрж┐ ржПржЯрж┐ ржПржХржЯрж┐ ржЯрзЗрж╕рзНржЯрж┐ржВ ржЖржЗржбрж┐ ржирж╛ рж╣ржпрж╝, рждржмрзЗ API ржХрж▓ ржХрж░рзБржи
        if (userId !== 'blogger_test_user_101' || isAdmin) {
             try {
                const response = await fetch(`${SERVER_URL}/api/register_or_check`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, refererId })
                });
                const data = await response.json();

                if (data.success) {
                    updateBalanceDisplay(data.earned_points, data.referral_count);
                    if (data.message && data.message.includes('Referral bonus')) {
                        showMessage('success', data.message, 5000);
                    }
                } else {
                    showMessage('danger', 'ржЗржЙржЬрж╛рж░ рж▓рзЛржб ржХрж░рждрзЗ ржмрзНржпрж░рзНрже: ' + (data.message || 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐'));
                    document.getElementById('loading-spinner').classList.add('hidden');
                }
            } catch (error) {
                console.error('Registration/Check error:', error);
                showMessage('danger', 'рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рждрзНрж░рзБржЯрж┐ (500). ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржкрж░рзЗ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред');
                document.getElementById('loading-spinner').classList.add('hidden');
            }
        } else {
            // ржпржжрж┐ API ржХрж▓ ржирж╛ ржХрж░рзЗ рждржмрзЗ ржбрзЗржорзЛ ржбрзЗржЯрж╛ ржжрзЗржЦрж╛ржи
            updateBalanceDisplay(0, 0); 
            showMessage('warning', 'ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо ржЕрзНржпрж╛ржкрзЗрж░ ржмрж╛ржЗрж░рзЗ ржЪрж▓ржЫрзЗ (ржкрж░рзАржХрзНрж╖рж╛рж░ ржЬржирзНржп)ред', 5000);
        }
    }

    // 2. Add Points (Simulating Ad Click)
    async function addPoints(points) {
        if (!currentUserId) {
            showMessage('danger', 'ржЗржЙржЬрж╛рж░ рж▓рзЛржб рж╣ржпрж╝ржирж┐ред ржкрзЗржЬржЯрж┐ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рзБржиред');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/add_points`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, points })
            });
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount);
                showMessage('success', `${points} ржкржпрж╝рзЗржирзНржЯ рж╕ржлрж▓ржнрж╛ржмрзЗ ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ!`);
            } else {
                showMessage('danger', 'ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рждрзЗ ржмрзНржпрж░рзНрже: ' + data.message);
            }
        } catch (error) {
            console.error('Add points error:', error);
            showMessage('danger', 'ржкржпрж╝рзЗржирзНржЯ ржпрзЛржЧ ржХрж░рж╛рж░ рж╕ржоржпрж╝ рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рждрзНрж░рзБржЯрж┐ред');
        }
    }
    
    // 3. Withdraw Request Submission (Time Check Added)
    document.getElementById('withdraw-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const pointsToWithdraw = parseInt(document.getElementById('points-to-withdraw').value);
        const paymentMethod = document.getElementById('payment-method').value;
        const paymentNumber = document.getElementById('payment-number').value;
        const withdrawMessageArea = document.getElementById('withdraw-message');
        
        withdrawMessageArea.classList.add('hidden');
        
        // ЁЯЫС ржЙржЗржержбрзНрж░ржпрж╝рж╛рж▓ рж╕ржоржпрж╝ ржЪрзЗржХ
        if (!isWithdrawalTime()) {
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = `ржЙрждрзНрждрзЛрж▓ржи рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕ржХрж╛рж▓ ${WITHDRAWAL_START_HOUR}:00 ржЯрж╛ ржерзЗржХрзЗ рж░рж╛ржд ${WITHDRAWAL_END_HOUR}:00 ржЯрж╛ ржкрж░рзНржпржирзНржд ржЪрж▓рзЗред ржПржЦржи ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред`;
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        if (pointsToWithdraw < MIN_WITHDRAWAL_POINTS || pointsToWithdraw > currentBalance) {
            withdrawMessageArea.className = 'alert alert-warning mt-3';
            withdrawMessageArea.innerText = 'ржЕржкрж░рзНржпрж╛ржкрзНржд ржкржпрж╝рзЗржирзНржЯ ржмрж╛ ржирзНржпрзВржирждржо ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржЪрзЗржпрж╝рзЗ ржХржоред';
            withdrawMessageArea.classList.remove('hidden');
            return;
        }

        try {
            const response = await fetch(`${SERVER_URL}/api/withdraw`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: currentUserId, pointsToWithdraw, paymentMethod, paymentNumber })
            });
            const data = await response.json();

            if (data.success) {
                updateBalanceDisplay(data.new_points, currentReferralCount);
                withdrawMessageArea.className = 'alert alert-success mt-3';
                withdrawMessageArea.innerText = 'ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржЕржирзБрж░рзЛржз рж╕ржлрж▓ржнрж╛ржмрзЗ ржЬржорж╛ рж╣ржпрж╝рзЗржЫрзЗ!';
                withdrawMessageArea.classList.remove('hidden');
                
                // Hide modal after a delay
                setTimeout(() => {
                    $('#withdrawModal').modal('hide');
                    document.getElementById('withdraw-form').reset();
                }, 2000);

            } else {
                withdrawMessageArea.className = 'alert alert-danger mt-3';
                withdrawMessageArea.innerText = 'ржЙрждрзНрждрзЛрж▓ржи ржмрзНржпрж░рзНрже: ' + data.message;
                withdrawMessageArea.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Withdraw error:', error);
            withdrawMessageArea.className = 'alert alert-danger mt-3';
            withdrawMessageArea.innerText = 'рж╕рж╛рж░рзНржнрж╛рж░ рж╕ржВржпрзЛржЧ рждрзНрж░рзБржЯрж┐ред';
            withdrawMessageArea.classList.remove('hidden');
        }
    });

    // --- UI/Utility Functions ---
    function showAdTasks() {
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('ad-tasks').classList.remove('hidden');
    }
    
    function hideAdTasks() {
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    // --- Admin Panel Handlers (Placeholder) ---
    function showAdminPanel() {
        if (!isAdmin) return;
        document.getElementById('main-content').classList.add('hidden');
        document.getElementById('ad-tasks').classList.add('hidden');
        document.getElementById('top-ad-banner').classList.add('hidden');
        document.getElementById('bottom-ad-banner').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        showMessage('danger', 'ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ рж▓рзЛржб рж╣ржпрж╝рзЗржЫрзЗред');

        // Note: ржПржЦрж╛ржирзЗ ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓рзЗрж░ ржбрзЗржЯрж╛ рж▓рзЛржбрж┐ржВ ржХрзЛржб ржпрзБржХрзНржд ржХрж░рждрзЗ рж╣ржмрзЗ (get_admin_stats, get_withdrawals)
    }

    function hideAdminPanel() {
        document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('top-ad-banner').classList.remove('hidden');
        document.getElementById('bottom-ad-banner').classList.remove('hidden');
    }

    function copyReferralLink() {
        if (!currentUserId) {
            showMessage('warning', 'ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐ рж▓рзЛржб рж╣ржпрж╝ржирж┐ред');
            return;
        }
        
        // тЪая╕П ржЖржкржирж╛рж░ ржмрзНрж▓ржЧрж╛рж░ URL ржПржЦрж╛ржирзЗ ржмрж╕рж╛ржи
        const referralLink = `YOUR_BLOGGER_URL?ref=${currentUserId}`;
        
        navigator.clipboard.writeText(referralLink).then(() => {
            showMessage('info', 'рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ! рж▓рж┐ржЩрзНржХ: ' + referralLink);
        }).catch(err => {
            console.error('Copy failed:', err);
            showMessage('warning', 'ржХржкрж┐ ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред рж▓рж┐ржЩрзНржХржЯрж┐ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ ржХржкрж┐ ржХрж░рзБржиред');
        });
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Load Bootstrap JS dependencies for Modal functionality
        const script1 = document.createElement('script');
        script1.src = "https://code.jquery.com/jquery-3.5.1.slim.min.js";
        document.head.appendChild(script1);

        const script2 = document.createElement('script');
        script2.src = "https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js";
        document.head.appendChild(script2);

        const script3 = document.createElement('script');
        script3.src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js";
        document.head.appendChild(script3);

        // Wait for DOM to load, then check user
        registerOrCheckUser();
    });

</script>
</body>
</html>
